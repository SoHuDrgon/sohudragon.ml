<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Upgrading Kubeadm Clusters From V1.14.1 to V1.15 - 飞雪连天射白鹿 笑书神侠倚碧鸳</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="SoHuDrgon" /><meta name="description" content="" /><meta name="keywords" content="Linux, Cloud, docker, Kubernetes, Gitlab" />






<meta name="generator" content="Hugo 0.55.1 with even 4.0.0" />


<link rel="canonical" href="https://sohudrgon.ml/post/upgrading-kubeadm-clusters-from-v1.14.1-to-v1.15.0/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Upgrading Kubeadm Clusters From V1.14.1 to V1.15" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sohudrgon.ml/post/upgrading-kubeadm-clusters-from-v1.14.1-to-v1.15.0/" />
<meta property="article:published_time" content="2019-07-02T14:42:04&#43;08:00"/>
<meta property="article:modified_time" content="2019-07-02T16:00:07&#43;08:00"/>

<meta itemprop="name" content="Upgrading Kubeadm Clusters From V1.14.1 to V1.15">
<meta itemprop="description" content="">


<meta itemprop="datePublished" content="2019-07-02T14:42:04&#43;08:00" />
<meta itemprop="dateModified" content="2019-07-02T16:00:07&#43;08:00" />
<meta itemprop="wordCount" content="0">



<meta itemprop="keywords" content="“kubernetes,kubeadm”," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Upgrading Kubeadm Clusters From V1.14.1 to V1.15"/>
<meta name="twitter:description" content=""/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">死亡笔记</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">死亡笔记</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Upgrading Kubeadm Clusters From V1.14.1 to V1.15</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-07-02 </span>
        <div class="post-category">
            <a href="/categories/kubernetes/"> “kubernetes” </a>
            </div>
          <span class="more-meta"> 约 0 字 </span>
          <span class="more-meta"> 预计阅读 0 分钟 </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li><a href="#kubernetes-v1-15-release-notes">Kubernetes v1.15 Release Notes</a>
<ul>
<li><a href="#1-15-what-s-new">1.15 What’s New</a>
<ul>
<li>
<ul>
<li><a href="#continuous-improvement">Continuous Improvement</a></li>
<li><a href="#extensibility">Extensibility</a></li>
</ul></li>
<li><a href="#extensibility-around-core-kubernetes-apis">Extensibility around core Kubernetes APIs</a>
<ul>
<li><a href="#customresourcedefinitions-pruning">CustomResourceDefinitions Pruning</a></li>
<li><a href="#customresourcedefinition-defaulting">CustomResourceDefinition Defaulting</a></li>
<li><a href="#customresourcedefinition-openapi-publishing">CustomResourceDefinition OpenAPI Publishing</a></li>
</ul></li>
<li><a href="#cluster-lifecycle-stability-and-usability-improvements">Cluster Lifecycle Stability and Usability Improvements</a></li>
<li><a href="#continued-improvement-of-csi">Continued improvement of CSI</a>
<ul>
<li><a href="#additional-notable-feature-updates">Additional Notable Feature Updates</a></li>
</ul></li>
</ul></li>
<li><a href="#known-issues">Known Issues</a></li>
<li><a href="#urgent-upgrade-notes">Urgent Upgrade Notes</a>
<ul>
<li><a href="#no-really-you-must-read-this-before-you-upgrade">(No, really, you MUST read this before you upgrade)</a>
<ul>
<li><a href="#api-machinery">API Machinery</a></li>
<li><a href="#apps">Apps</a></li>
<li><a href="#auth">Auth</a></li>
<li><a href="#cli">CLI</a></li>
<li><a href="#lifecycle">Lifecycle</a></li>
<li><a href="#network">Network</a></li>
<li><a href="#node">Node</a></li>
<li><a href="#storage">Storage</a></li>
</ul></li>
</ul></li>
<li><a href="#deprecations-and-removals">Deprecations and Removals</a></li>
<li><a href="#metrics-changes">Metrics Changes</a>
<ul>
<li><a href="#added-metrics">Added metrics</a></li>
<li><a href="#deprecated-changed-metrics">Deprecated/changed metrics</a></li>
</ul></li>
<li><a href="#notable-features">Notable Features</a>
<ul>
<li><a href="#stable">Stable</a></li>
<li><a href="#beta">Beta</a></li>
<li><a href="#alpha">Alpha</a></li>
<li><a href="#staging-repositories">Staging Repositories</a></li>
<li><a href="#cli-improvements">CLI Improvements</a></li>
<li><a href="#misc">Misc</a></li>
</ul></li>
<li><a href="#api-changes">API Changes</a></li>
<li><a href="#other-notable-changes">Other notable changes</a>
<ul>
<li><a href="#api-machinery-1">API Machinery</a></li>
<li><a href="#apps-1">Apps</a></li>
<li><a href="#auth-1">Auth</a></li>
<li><a href="#autoscaling">Autoscaling</a></li>
<li><a href="#cli-1">CLI</a></li>
<li><a href="#cloud-provider">Cloud Provider</a></li>
<li><a href="#cluster-lifecycle">Cluster Lifecycle</a></li>
<li><a href="#gcp">GCP</a></li>
<li><a href="#instrumentation">Instrumentation</a></li>
<li><a href="#network-1">Network</a></li>
<li><a href="#node-1">Node</a></li>
<li><a href="#openstack">OpenStack</a></li>
<li><a href="#release">Release</a></li>
<li><a href="#scheduling">Scheduling</a></li>
<li><a href="#storage-1">Storage</a></li>
</ul></li>
<li><a href="#dependencies">Dependencies</a>
<ul>
<li><a href="#changed">Changed</a></li>
<li><a href="#unchanged">Unchanged</a></li>
</ul></li>
</ul></li>
<li><a href="#upgrading-kubeadm-clusters-from-v1-14-to-v1-15">Upgrading kubeadm clusters from v1.14 to v1.15</a>
<ul>
<li>
<ul>
<li><a href="#additional-information">Additional information</a></li>
</ul></li>
<li><a href="#determine-which-version-to-upgrade-to">Determine which version to upgrade to</a></li>
<li><a href="#upgrade-the-first-control-plane-node">Upgrade the first control plane node</a></li>
<li><a href="#upgrade-additional-control-plane-nodes">Upgrade additional control plane nodes</a></li>
<li><a href="#upgrade-worker-nodes">Upgrade worker nodes</a>
<ul>
<li><a href="#upgrade-kubeadm">Upgrade kubeadm</a></li>
<li><a href="#drain-the-node">Drain the node</a></li>
<li><a href="#upgrade-the-kubelet-configuration">Upgrade the kubelet configuration</a></li>
<li><a href="#upgrade-kubelet-and-kubectl">Upgrade kubelet and kubectl</a></li>
<li><a href="#uncordon-the-node">Uncordon the node</a></li>
</ul></li>
<li><a href="#verify-the-status-of-the-cluster">Verify the status of the cluster</a></li>
<li><a href="#recovering-from-a-failure-state">Recovering from a failure state</a></li>
<li><a href="#how-it-works">How it works</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>
    <div class="post-content">
      

<h1 id="kubernetes-v1-15-release-notes">Kubernetes v1.15 Release Notes</h1>

<h2 id="1-15-what-s-new">1.15 What’s New</h2>

<p>A complete changelog for the release notes is now hosted in a customizable format at <a href="https://relnotes.k8s.io/?releaseVersions=1.15.0">https://relnotes.k8s.io/</a>. Check it out and please give us your feedback!</p>

<p>Kubernetes 1.15 consists of <strong>25 enhancements</strong>: 2 moving to stable, 13 in beta, and 10 in alpha. The main themes of this release are:</p>

<h4 id="continuous-improvement">Continuous Improvement</h4>

<ul>
<li>Project sustainability is not just about features. Many SIGs have been working on  improving test coverage, ensuring the basics stay reliable, and stability of the core feature set and working on maturing existing features and cleaning up the backlog.</li>
</ul>

<h4 id="extensibility">Extensibility</h4>

<ul>
<li>The community has been asking for continuing support of extensibility, so this cycle features more work around CRDs and API Machinery. Most of the enhancements in this cycle were from SIG API Machinery and related areas.</li>
</ul>

<h3 id="extensibility-around-core-kubernetes-apis">Extensibility around core Kubernetes APIs</h3>

<h4 id="customresourcedefinitions-pruning">CustomResourceDefinitions Pruning</h4>

<p>To enforce both data consistency and security, Kubernetes performs pruning, or the automatic removal of unknown fields in objects sent to a Kubernetes API. An &ldquo;unknown&rdquo; field is one that is not specified in the OpenAPI validation schema. This behavior is already in place for native resources and ensures only data structures specified by the CRD developer are persisted to etcd. It will be available as a beta feature in Kubernetes 1.15.</p>

<p>Pruning is activated by setting <code>spec.preserveUnknownFields: false</code> in the CustomResourceDefinition. A future apiextensions.k8s.io/v1 variant of CRDs will enforce pruning.</p>

<p>Pruning requires that CRD developer provides complete, structural validation schemas, either at the top-level or for all versions of the CRD.</p>

<h4 id="customresourcedefinition-defaulting">CustomResourceDefinition Defaulting</h4>

<p>CustomResourceDefinitions also have new support for defaulting, with defaults specified using the <code>default</code> keyword in the OpenAPI validation schema. Defaults are set for unspecified fields in an object sent to the API, and when reading from etcd.</p>

<p>Defaulting will be available as alpha in Kubernetes 1.15 and requires structural schemas.</p>

<h4 id="customresourcedefinition-openapi-publishing">CustomResourceDefinition OpenAPI Publishing</h4>

<p>OpenAPI specs for native types have long been served at /openapi/v2, and they are consumed by a number of components, notably kubectl client-side validation, kubectl explain and OpenAPI based client generators.</p>

<p>With Kubernetes 1.15 as beta, OpenAPI schemas are also published for CRDs, as long as their schemas are structural.</p>

<p>These changes are reflected in the following Kubernetes enhancements:
(<a href="https://github.com/kubernetes/enhancements/issues/383">#383</a>), (<a href="https://github.com/kubernetes/enhancements/issues/575">#575</a> ), (<a href="https://github.com/kubernetes/enhancements/issues/492">#492</a> ), (<a href="https://github.com/kubernetes/enhancements/issues/598">#598</a> ), (<a href="https://github.com/kubernetes/enhancements/issues/692">#692</a> ), (<a href="https://github.com/kubernetes/enhancements/issues/95">#95</a> ), (<a href="https://github.com/kubernetes/enhancements/issues/995">#995</a> ), (<a href="https://github.com/kubernetes/enhancements/issues/956">#956</a> )</p>

<h3 id="cluster-lifecycle-stability-and-usability-improvements">Cluster Lifecycle Stability and Usability Improvements</h3>

<p>Work on making Kubernetes installation, upgrade and configuration even more robust has been a major focus for this cycle for SIG Cluster Lifecycle (see the May 6, 2019 <a href="https://docs.google.com/presentation/d/1QUOsQxfEfHlMq4lPjlK2ewQHsr9peEKymDw5_XwZm8Q/edit?usp=sharing">Community Update</a>). Bug fixes across bare metal tooling and production-ready user stories, such as the high availability use cases have been given priority for 1.15.</p>

<p>kubeadm, the cluster lifecycle building block, continues to receive features and stability work required for bootstrapping production clusters efficiently. kubeadm has promoted high availability (HA) capability to beta, allowing users to use the familiar <code>kubeadm init</code> and <code>kubeadm join</code> commands to <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/high-availability/">configure and deploy an HA control plane</a>. An entire new test suite has been created specifically for ensuring these features will stay stable over time.</p>

<p>Certificate management has become more robust in 1.15, with kubeadm now seamlessly rotating all your certificates (on upgrades) before they expire. Check the <a href="https://github.com/kubernetes/website/blob/dev-1.15/content/en/docs/reference/setup-tools/kubeadm/kubeadm-alpha.md">kubeadm documentation</a> for information on how to manage your certificates.</p>

<p>The kubeadm configuration file API is moving from v1beta1 to v1beta2 in 1.15.</p>

<p>These changes are reflected in the following Kubernetes enhancements:
(<a href="https://github.com/kubernetes/enhancements/issues/357">#357</a> ), (<a href="https://github.com/kubernetes/enhancements/issues/970">#970</a> )</p>

<h3 id="continued-improvement-of-csi">Continued improvement of CSI</h3>

<p>In Kubernetes v1.15, SIG Storage continued work to <a href="https://github.com/kubernetes/enhancements/issues/625">enable migration of in-tree volume plugins</a> to the Container Storage Interface (CSI). SIG Storage worked on bringing CSI to feature parity with in-tree functionality, including functionality like resizing, inline volumes, and more. SIG Storage introduces new alpha functionality in CSI that doesn&rsquo;t exist in the Kubernetes Storage subsystem yet, like volume cloning.</p>

<p>Volume cloning enables users to specify another PVC as a &ldquo;DataSource&rdquo; when provisioning a new volume. If the underlying storage system supports this functionality and implements the &ldquo;CLONE_VOLUME&rdquo; capability in its CSI driver, then the new volume becomes a clone of the source volume.</p>

<p>These changes are reflected in the following Kubernetes enhancements:
(<a href="https://github.com/kubernetes/enhancements/issues/625">#625</a>)</p>

<h4 id="additional-notable-feature-updates">Additional Notable Feature Updates</h4>

<ul>
<li>Support for go modules in Kubernetes Core.</li>
<li>Continued preparation for cloud provider extraction and code organization.  The cloud provider code has been moved to kubernetes/legacy-cloud-providers for easier removal later and external consumption.</li>
<li>Kubectl <a href="https://github.com/kubernetes/enhancements/issues/515">get and describe</a> now works with extensions</li>
<li>Nodes now support <a href="https://github.com/kubernetes/enhancements/issues/606">third party monitoring plugins</a>.</li>
<li>A new <a href="https://github.com/kubernetes/enhancements/issues/624">Scheduling Framework</a> for schedule plugins is now Alpha.</li>
<li>ExecutionHook API <a href="https://github.com/kubernetes/enhancements/issues/962">designed to trigger hook commands</a> in containers is now Alpha.</li>
<li>Continued deprecation of extensions/v1beta1, apps/v1beta1, and apps/v1beta2 APIs; these extensions will be retired in 1.16!</li>
</ul>

<p>Check the <a href="https://relnotes.k8s.io/?releaseVersions=1.15.0">release notes website</a> for the complete changelog of notable features and fixes.</p>

<h2 id="known-issues">Known Issues</h2>

<ul>
<li><p>Concurrently joining control-plane nodes does not work as expected in kubeadm 1.15.0. The feature was planned for release in 1.15.0, but a fix may  come in a follow up patch release.</p></li>

<li><p>Using <code>--log-file</code> is known to be problematic in 1.15. This presents as things being logged multiple times to the same file. The behaviour and details of this issue, as well as some preliminary attempts at fixing it are documented <a href="https://github.com/kubernetes/kubernetes/issues/78734#issuecomment-501372131">here</a></p></li>
</ul>

<h2 id="urgent-upgrade-notes">Urgent Upgrade Notes</h2>

<h3 id="no-really-you-must-read-this-before-you-upgrade">(No, really, you MUST read this before you upgrade)</h3>

<h4 id="api-machinery">API Machinery</h4>

<ul>
<li><code>k8s.io/kubernetes</code> and published components (such as <code>k8s.io/client-go</code> and <code>k8s.io/api</code>) now contain go module files including dependency version information. See <a href="http://git.k8s.io/client-go/INSTALL.md#go-modules">go-modules</a> for details on consuming <code>k8s.io/client-go</code> using go modules. (<a href="https://github.com/kubernetes/kubernetes/pull/74877">#74877</a>, <a href="https://github.com/liggitt">@liggitt</a>)</li>
</ul>

<h4 id="apps">Apps</h4>

<ul>
<li>Hyperkube short aliases have been removed from source code, because hyperkube docker image currently creates these aliases. (<a href="https://github.com/kubernetes/kubernetes/pull/76953">#76953</a>, <a href="https://github.com/Rand01ph">@Rand01ph</a>)</li>
</ul>

<h4 id="auth">Auth</h4>

<ul>
<li>The Rancher credential provider has now been removed. This only affects you if you are using the downstream Rancher distro. (<a href="https://github.com/kubernetes/kubernetes/pull/77099">#77099</a>, <a href="https://github.com/dims">@dims</a>)</li>
</ul>

<h4 id="cli">CLI</h4>

<ul>
<li><code>kubectl scale job</code>, deprecated since 1.10, has been removed. (<a href="https://github.com/kubernetes/kubernetes/pull/78445">#78445</a>, <a href="https://github.com/soltysh">@soltysh</a>)</li>
<li>The deprecated <code>--pod</code>/<code>-p</code> flag for <code>kubectl exec</code> has been removed. The flag has been marked as deprecated since k8s version v1.12. (<a href="https://github.com/kubernetes/kubernetes/pull/76713">#76713</a>, <a href="https://github.com/prksu">@prksu</a>)</li>
</ul>

<h4 id="lifecycle">Lifecycle</h4>

<ul>
<li>Support for deprecated old kubeadm v1alpha3 config has been totally removed. (<a href="https://github.com/kubernetes/kubernetes/pull/75179">#75179</a>, <a href="https://github.com/rosti">@rosti</a>)</li>
<li>kube-up.sh no longer supports &ldquo;centos&rdquo; and &ldquo;local&rdquo; providers. (<a href="https://github.com/kubernetes/kubernetes/pull/76711">#76711</a>, <a href="https://github.com/dims">@dims</a>)</li>
</ul>

<h4 id="network">Network</h4>

<ul>
<li>The deprecated flag <code>--conntrack-max</code> has been removed from kube-proxy. Users of this flag should switch to <code>--conntrack-min</code> and <code>--conntrack-max-per-core</code> instead. (<a href="https://github.com/kubernetes/kubernetes/pull/78399">#78399</a>, <a href="https://github.com/rikatz">@rikatz</a>)</li>
<li>The deprecated kube-proxy flag <code>--cleanup-iptables</code> has been removed. (<a href="https://github.com/kubernetes/kubernetes/pull/78344">#78344</a>, <a href="https://github.com/aramase">@aramase</a>)</li>
</ul>

<h4 id="node">Node</h4>

<ul>
<li>The deprecated kubelet security controls <code>AllowPrivileged</code>, <code>HostNetworkSources</code>, <code>HostPIDSources</code>, and <code>HostIPCSources</code> have been removed. Enforcement of these restrictions should be done through admission control (such as <code>PodSecurityPolicy</code>) instead. (<a href="https://github.com/kubernetes/kubernetes/pull/77820">#77820</a>, <a href="https://github.com/dims">@dims</a>)</li>
<li>The deprecated Kubelet flag <code>--allow-privileged</code> has been removed. Remove any use of the flag from your kubelet scripts or manifests. (<a href="https://github.com/kubernetes/kubernetes/pull/77820">#77820</a>, <a href="https://github.com/dims">@dims</a>)</li>
<li>The kubelet now only collects cgroups metrics for the node, container runtime, kubelet, pods, and containers. (<a href="https://github.com/kubernetes/kubernetes/pull/72787">#72787</a>, <a href="https://github.com/dashpole">@dashpole</a>)</li>
</ul>

<h4 id="storage">Storage</h4>

<ul>
<li>The <code>Node.Status.Volumes.Attached.DevicePath</code> field is now unset for CSI volumes. You must update any external controllers that depend on this field. (<a href="https://github.com/kubernetes/kubernetes/pull/75799">#75799</a>, <a href="https://github.com/msau42">@msau42</a>)</li>
<li>CSI alpha CRDs have been removed (<a href="https://github.com/kubernetes/kubernetes/pull/75747">#75747</a>, <a href="https://github.com/msau42">@msau42</a>)</li>
<li>The <code>StorageObjectInUseProtection</code> admission plugin is enabled by default, so  the default enabled admission plugins are now <code>NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,StorageObjectInUseProtection</code>. Please note that if you previously had not set the <code>--admission-control</code> flag, your cluster behavior may change (to be more standard). (<a href="https://github.com/kubernetes/kubernetes/pull/74610">#74610</a>, <a href="https://github.com/oomichi">@oomichi</a>)</li>
</ul>

<h2 id="deprecations-and-removals">Deprecations and Removals</h2>

<ul>
<li><p>kubectl</p>

<ul>
<li><code>kubectl convert</code>, deprecated since v1.14, will be removed in v1.17.</li>
<li>The <code>--export</code> flag for the <code>kubectl get</code> command, deprecated since v1.14, will be removed in v1.18.</li>
<li>The <code>--pod</code>/<code>-p</code> flag for <code>kubectl exec</code>, deprecated since 1.12, has been removed.</li>
<li><code>kubectl scale job</code>, deprecated since 1.10, has been removed. (<a href="https://github.com/kubernetes/kubernetes/pull/78445">#78445</a>, <a href="https://github.com/soltysh">@soltysh</a>)</li>
</ul></li>

<li><p>kubelet</p>

<ul>
<li>The <code>beta.kubernetes.io/os</code> and <code>beta.kubernetes.io/arch</code> labels, deprecated since v1.14, are targeted for removal in v1.18.</li>
<li>The <code>--containerized</code> flag, deprecated since v1.14, will be removed in a future release.</li>
<li>cAdvisor json endpoints have been deprecated. (<a href="https://github.com/kubernetes/kubernetes/pull/78504">#78504</a>, <a href="https://github.com/dashpole">@dashpole</a>)</li>
</ul></li>

<li><p>kube-apiserver</p>

<ul>
<li>The <code>--enable-logs-handler</code> flag and log-serving functionality is deprecated, and scheduled to be removed in v1.19. (<a href="https://github.com/kubernetes/kubernetes/pull/77611">#77611</a>, <a href="https://github.com/rohitsardesai83">@rohitsardesai83</a>)</li>
</ul></li>

<li><p>kube-proxy</p>

<ul>
<li>The deprecated <code>--cleanup-iptables</code> has been removed,. (<a href="https://github.com/kubernetes/kubernetes/pull/78344">#78344</a>, <a href="https://github.com/aramase">@aramase</a>)</li>
</ul></li>

<li><p>API</p>

<ul>
<li>Ingress resources will no longer be served from <code>extensions/v1beta1</code> in v1.19. Migrate use to the <code>networking.k8s.io/v1beta1</code> API, available since v1.14. Existing persisted data can be retrieved via the <code>networking.k8s.io/v1beta1</code> API.</li>
<li>NetworkPolicy resources will no longer be served from <code>extensions/v1beta1</code> in v1.16. Migrate use to the <code>networking.k8s.io/v1</code> API, available since v1.8. Existing persisted data can be retrieved via the <code>networking.k8s.io/v1</code> API.</li>
<li>PodSecurityPolicy resources will no longer be served from <code>extensions/v1beta1</code> in v1.16. Migrate to the <code>policy/v1beta1</code> API, available since v1.10. Existing persisted data can be retrieved via the <code>policy/v1beta1</code> API.</li>
<li>DaemonSet, Deployment, and ReplicaSet resources will no longer be served from <code>extensions/v1beta1</code>, <code>apps/v1beta1</code>, or <code>apps/v1beta2</code> in v1.16. Migrate to the <code>apps/v1</code> API, available since v1.9. Existing persisted data can be retrieved via the <code>apps/v1</code> API.</li>
<li>PriorityClass resources will no longer be served from <code>scheduling.k8s.io/v1beta1</code> and <code>scheduling.k8s.io/v1alpha1</code> in v1.17. Migrate use to the <code>scheduling.k8s.io/v1</code> API, available since v1.14. Existing persisted data can be retrieved via the <code>scheduling.k8s.io/v1</code> API.</li>
<li>The <code>export</code> query parameter for list API calls, deprecated since v1.14, will be removed in v1.18.</li>
<li>The <code>series.state</code> field in the events.k8s.io/v1beta1 Event API is deprecated and will be removed in v1.18 (<a href="https://github.com/kubernetes/kubernetes/pull/75987">#75987</a>, <a href="https://github.com/yastij">@yastij</a>)</li>
</ul></li>

<li><p>kubeadm</p>

<ul>
<li>The <code>kubeadm upgrade node config</code> and <code>kubeadm upgrade node experimental-control-plane</code> commands are deprecated in favor of <code>kubeadm upgrade node</code>, and will be removed in a future release. (<a href="https://github.com/kubernetes/kubernetes/pull/78408">#78408</a>, <a href="https://github.com/fabriziopandini">@fabriziopandini</a>)</li>
<li>The flag <code>--experimental-control-plane</code> is now deprecated in favor of  <code>--control-plane</code>. The flag <code>--experimental-upload-certs</code> is now deprecated in favor of <code>--upload-certs</code> (<a href="https://github.com/kubernetes/kubernetes/pull/78452">#78452</a>, <a href="https://github.com/fabriziopandini">@fabriziopandini</a>)</li>
<li><code>kubeadm config upload</code> has been deprecated, as its replacement is now graduated. Please use <code>kubeadm init phase upload-config</code> instead. (<a href="https://github.com/kubernetes/kubernetes/pull/77946">#77946</a>, <a href="https://github.com/Klaven">@Klaven</a>)</li>
</ul></li>

<li><p>The following features are now GA, and the associated feature gates are deprecated and will be removed in v1.17:</p>

<ul>
<li><code>GCERegionalPersistentDisk</code></li>
</ul></li>
</ul>

<h2 id="metrics-changes">Metrics Changes</h2>

<h3 id="added-metrics">Added metrics</h3>

<ul>
<li>The metric <code>kube_proxy_sync_proxy_rules_last_timestamp_seconds</code> is now available, indicating the last time that kube-proxy successfully applied proxying rules. (<a href="https://github.com/kubernetes/kubernetes/pull/74027">#74027</a>, <a href="https://github.com/squeed">@squeed</a>)</li>
<li><code>process_start_time_seconds</code> has been added to kubelet’s &lsquo;/metrics/probes&rsquo; endpoint (<a href="https://github.com/kubernetes/kubernetes/pull/77975">#77975</a>, <a href="https://github.com/logicalhan">@logicalhan</a>)</li>
<li>Scheduler: added metrics to record the number of pending pods in different queues (<a href="https://github.com/kubernetes/kubernetes/pull/75501">#75501</a>, <a href="https://github.com/Huang-Wei">@Huang-Wei</a>)</li>
<li>Exposed CSI volume stats via kubelet volume metrics (<a href="https://github.com/kubernetes/kubernetes/pull/76188">#76188</a>, <a href="https://github.com/humblec">@humblec</a>)</li>
<li>Added a new <code>storage_operation_status_count</code> metric for kube-controller-manager and kubelet to count success and error statues. (<a href="https://github.com/kubernetes/kubernetes/pull/75750">#75750</a>, <a href="https://github.com/msau42">@msau42</a>)</li>
</ul>

<h3 id="deprecated-changed-metrics">Deprecated/changed metrics</h3>

<ul>
<li>kubelet probe metrics are now of the counter type rather than the gauge type, and the <code>prober_probe_result</code> has been replaced by <code>prober_probe_total</code>. (<a href="https://github.com/kubernetes/kubernetes/pull/76074">#76074</a>, <a href="https://github.com/danielqsj">@danielqsj</a>)</li>
<li>The <code>transformer_failures_total</code> metric is deprecated in favor of <code>transformation_operation_total</code>. The old metric will continue to be populated but will be removed in a future release. (<a href="https://github.com/kubernetes/kubernetes/pull/70715">#70715</a>, <a href="https://github.com/immutableT">@immutableT</a>)</li>

<li><p>Introducing new semantic for metric <code>volume_operation_total_seconds</code> to be the end to end latency of volume provisioning/deletion. Existing metric &ldquo;storage_operation_duration_seconds&rdquo; will remain untouched, however it is exposed to the following potential issues:</p>

<ol>
<li>For volumes provisioned/deleted via external provisioner/deleter, <code>storage_operation_duration_seconds</code> will NOT wait for the external operation to be done before reporting latency metric (effectively close to 0). This will be fixed by using <code>volume_operation_total_seconds</code> instead</li>
<li>if there&rsquo;s a transient error happened during &ldquo;provisioning/deletion&rdquo;, i.e., a volume is still in-use while a deleteVolume has been called, original <code>storage_operation_duration_seconds</code> will NOT wait until a volume has been finally deleted before reporting an inaccurate latency metric. The newly implemented metric <code>volume_operation_total_seconds</code>, however, waits until a provisioning/deletion operation has been fully executed.</li>
</ol>

<p>Potential impacts:
If an SLO/alert has been defined based on <code>volume_operation_total_seconds</code>, it might get violated because of the more accurate metric might be significantly larger than previously reported. The metric is defined to be a histogram and the new semantic could change the distribution. (<a href="https://github.com/kubernetes/kubernetes/pull/78061">#78061</a>, <a href="https://github.com/yuxiangqian">@yuxiangqian</a>)</p></li>

<li><p>Implement the scheduling framework with <code>Reserve</code>, <code>Prebind</code>, <code>Permit</code>, <code>Post-bind</code>, <code>Queue sort</code> and <code>Unreserve</code> extension points.
(<a href="https://github.com/kubernetes/kubernetes/pull/77567">#77567</a>, <a href="https://github.com/wgliang">@wgliang</a>)
(<a href="https://github.com/kubernetes/kubernetes/pull/77559">#77559</a>, <a href="https://github.com/ahg-g">@ahg-g</a>)
(<a href="https://github.com/kubernetes/kubernetes/pull/77529">#77529</a>, <a href="https://github.com/draveness">@draveness</a>)
(<a href="https://github.com/kubernetes/kubernetes/pull/77598">#77598</a>, <a href="https://github.com/danielqsj">@danielqsj</a>)
(<a href="https://github.com/kubernetes/kubernetes/pull/77501">#77501</a>, <a href="https://github.com/JieJhih">@JieJhih</a>)
(<a href="https://github.com/kubernetes/kubernetes/pull/77457">#77457</a>, <a href="https://github.com/danielqsj">@danielqsj</a>)</p></li>

<li><p>Replaced *_admission_latencies_milliseconds_summary and *_admission_latencies_milliseconds metrics because they were reporting seconds rather than milliseconds. They were also subject to multiple naming guideline violations (units should be in base units and &ldquo;duration&rdquo; is the best practice labelling to measure the time a request takes). Please convert to use *_admission_duration_seconds and *_admission_duration_seconds_summary, as these now report the unit as described, and follow the instrumentation best practices. (<a href="https://github.com/kubernetes/kubernetes/pull/75279">#75279</a>, <a href="https://github.com/danielqsj">@danielqsj</a>)</p></li>

<li><p>Fixed admission metrics histogram bucket sizes to cover 25ms to ~2.5 seconds. (<a href="https://github.com/kubernetes/kubernetes/pull/78608">#78608</a>, <a href="https://github.com/jpbetz">@jpbetz</a>)</p></li>

<li><p>Fixed incorrect prometheus azure metrics. (<a href="https://github.com/kubernetes/kubernetes/pull/77722">#77722</a>, <a href="https://github.com/andyzhangx">@andyzhangx</a>)</p></li>

<li><p><code>kubectl scale job</code>, deprecated since 1.10, has been removed. (<a href="https://github.com/kubernetes/kubernetes/pull/78445">#78445</a>, <a href="https://github.com/soltysh">@soltysh</a>)</p></li>
</ul>

<h2 id="notable-features">Notable Features</h2>

<h3 id="stable">Stable</h3>

<ul>
<li>The kube-apiserver’s <code>watch</code> can now be enabled for events using the <code>--watch-cache-sizes</code> flag. (<a href="https://github.com/kubernetes/kubernetes/pull/74321">#74321</a>, <a href="https://github.com/yastij">@yastij</a>)</li>
</ul>

<h3 id="beta">Beta</h3>

<ul>
<li>Admission webhooks can now register for a single version of a resource (for example, <code>apps/v1 deployments</code>) and be called when any other version of that resource is modified (for example <code>extensions/v1beta1 deployments</code>). This allows new versions of a resource to be handled by admission webhooks without needing to update every webhook to understand the new version. See the API documentation for the <code>matchPolicy: Equivalent</code> option in MutatingWebhookConfiguration and ValidatingWebhookConfiguration types. (<a href="https://github.com/kubernetes/kubernetes/pull/78135">#78135</a>, <a href="https://github.com/liggitt">@liggitt</a>)</li>
<li>Third party device monitoring is now beta, and enabled by default (KubeletPodResources). (<a href="https://github.com/kubernetes/kubernetes/pull/77274">#77274</a>, <a href="https://github.com/RenaudWasTaken">@RenaudWasTaken</a>)</li>
<li>The CustomResourcePublishOpenAPI feature is now beta and enabled by default. CustomResourceDefinitions with <a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-api-machinery/20190425-structural-openapi.md">structural schemas</a> now publish schemas in the OpenAPI document served at <code>/openapi/v2</code>. CustomResourceDefinitions with non-structural schemas have a <code>NonStructuralSchema</code> condition added with details about what needs to be corrected in the validation schema. (<a href="https://github.com/kubernetes/kubernetes/pull/77825">#77825</a>, <a href="https://github.com/roycaihw">@roycaihw</a>)</li>
<li>Online volume expansion (ExpandInUsePersistentVolumes) is now a beta feature. As such, it is enabled by default. (<a href="https://github.com/kubernetes/kubernetes/pull/77755">#77755</a>, <a href="https://github.com/gnufied">@gnufied</a>)</li>
<li>The <code>SupportNodePidsLimit</code> feature is now beta, and enabled by default.  It is no longer necessary to set the feature gate <code>SupportNodePidsLimit=true</code>. (<a href="https://github.com/kubernetes/kubernetes/pull/76221">#76221</a>, <a href="https://github.com/RobertKrawitz">@RobertKrawitz</a>)</li>
<li>kubeadm now includes the ability to specify certificate encryption and decryption keys for the upload and download certificate phases as part of the new v1beta2 kubeadm config format. (<a href="https://github.com/kubernetes/kubernetes/pull/77012">#77012</a>, <a href="https://github.com/rosti">@rosti</a>)</li>
<li>You can now use kubeadm&rsquo;s <code>InitConfiguration</code> and <code>JoinConfiguration</code> to define which preflight errors will be ignored. (<a href="https://github.com/kubernetes/kubernetes/pull/75499">#75499</a>, <a href="https://github.com/marccarre">@marccarre</a>)</li>
<li>CustomResourcesDefinition conversion via Web Hooks is promoted to beta. Note that you must set <code>spec.preserveUnknownFields</code> to <code>false</code>. (<a href="https://github.com/kubernetes/kubernetes/pull/78426">#78426</a>, <a href="https://github.com/sttts">@sttts</a>)</li>
<li>Group Managed Service Account support has moved to a new API for beta. Special annotations for Windows GMSA support have been deprecated.
(<a href="https://github.com/kubernetes/kubernetes/pull/75459">#75459</a>, <a href="https://github.com/wk8">@wk8</a>)</li>
<li>The <code>storageVersionHash</code> feature is now beta. <code>StorageVersionHash</code> is a field in the discovery document of each resource. It enables clients to detect whether the storage version of that resource has changed. Its value must be treated as opaque by clients. Only equality comparison on the value is valid. (<a href="https://github.com/kubernetes/kubernetes/pull/78325">#78325</a>, <a href="https://github.com/caesarxuchao">@caesarxuchao</a>)</li>
<li>Ingress objects are now persisted in etcd using the <code>networking.k8s.io/v1beta1</code> version (<a href="https://github.com/kubernetes/kubernetes/pull/77139">#77139</a>, <a href="https://github.com/cmluciano">@cmluciano</a>)</li>
<li>NodeLocal DNSCache graduating to beta. (<a href="https://github.com/kubernetes/kubernetes/pull/77887">#77887</a>, <a href="https://github.com/prameshj">@prameshj</a>)</li>
</ul>

<h3 id="alpha">Alpha</h3>

<ul>
<li>You can now create a non-preempting Pod priority (NonPreemptingPriority). If set on a class, the pod will continue to be prioritized above queued pods of a lesser class, but will not preempt running pods. (<a href="https://github.com/kubernetes/kubernetes/pull/74614">#74614</a>, <a href="https://github.com/denkensk">@denkensk</a>)</li>
<li>kubelet now allows the use of XFS quotas (on XFS and suitably configured ext4fs filesystems) to monitor storage consumption for ephemeral storage.  This method of monitoring consumption, which is currently available only for <code>emptyDir</code> volumes, is faster and more accurate than the old method of walking the filesystem tree. Note that it does not enforce limits, it only monitors consumption. To utilize this functionality, set the feature gate <code>LocalStorageCapacityIsolationFSQuotaMonitoring=true</code>. For ext4fs filesystems, create the filesystem with <code>mkfs.ext4 -O project &lt;block_device&gt;</code> and run <code>tune2fs -Q prjquota</code>block device<code>; XFS filesystems need no additional preparation. The filesystem must be mounted with option</code>project<code>in</code>/etc/fstab<code>. If the primary partition is the root filesystem, add</code>rootflags=pquota` to the GRUB config file. (<a href="https://github.com/kubernetes/kubernetes/pull/66928">#66928</a>, <a href="https://github.com/RobertKrawitz">@RobertKrawitz</a>)</li>
<li>Finalizer Protection for Service LoadBalancers (ServiceLoadBalancerFinalizer) has been added as an Alpha feature, which is disabled by default. This feature ensures the Service resource is not fully deleted until the correlating load balancer resources are deleted. (<a href="https://github.com/kubernetes/kubernetes/pull/78262">#78262</a>, <a href="https://github.com/MrHohn">@MrHohn</a>)</li>
<li>Inline CSI ephemeral volumes can now be controlled with PodSecurityPolicy when the CSIInlineVolume alpha feature is enabled. (<a href="https://github.com/kubernetes/kubernetes/pull/76915">#76915</a>, <a href="https://github.com/vladimirvivien">@vladimirvivien</a>)</li>
<li>Kubernetes now includes an alpha field, <code>AllowWatchBookmarks</code>, in ListOptions for requesting the watching of bookmarks from apiserver. The implementation in apiserver is hidden behind the feature gate <code>WatchBookmark</code>. (<a href="https://github.com/kubernetes/kubernetes/pull/74074">#74074</a>, <a href="https://github.com/wojtek-t">@wojtek-t</a>)</li>
</ul>

<h3 id="staging-repositories">Staging Repositories</h3>

<ul>
<li>The CRI API is now available in the <code>k8s.io/cri-api</code> staging repository. (<a href="https://github.com/kubernetes/kubernetes/pull/75531">#75531</a>, <a href="https://github.com/dims">@dims</a>)</li>
<li>Support for the Azure File plugin has been added to <code>csi-translation-lib</code> (CSIMigrationAzureFile). (<a href="https://github.com/kubernetes/kubernetes/pull/78356">#78356</a>, <a href="https://github.com/andyzhangx">@andyzhangx</a>)</li>
<li>Added support for Azure Disk plugin to csi-translation-lib (CSIMigrationAzureDisk) (<a href="https://github.com/kubernetes/kubernetes/pull/78330">#78330</a>, <a href="https://github.com/andyzhangx">@andyzhangx</a>)</li>
</ul>

<h3 id="cli-improvements">CLI Improvements</h3>

<ul>
<li>Added <code>kubeadm upgrade node</code>. This command can be used to upgrade both secondary control-plane nodes and worker nodes. The <code>kubeadm upgrade node config</code> and <code>kubeadm upgrade node experimental-control-plane</code> commands are now deprecated. (<a href="https://github.com/kubernetes/kubernetes/pull/78408">#78408</a>, <a href="https://github.com/fabriziopandini">@fabriziopandini</a>)</li>
<li>The <code>kubectl top</code> command now includes a <code>--sort-by</code> option to sort by <code>memory</code> or <code>cpu</code>. (<a href="https://github.com/kubernetes/kubernetes/pull/75920">#75920</a>, <a href="https://github.com/artmello">@artmello</a>)</li>
<li><code>kubectl rollout restart</code> now works for DaemonSets and StatefulSets. (<a href="https://github.com/kubernetes/kubernetes/pull/77423">#77423</a>, <a href="https://github.com/apelisse">@apelisse</a>)</li>
<li><code>kubectl get --watch=true</code> now prints custom resource definitions with custom print columns. (<a href="https://github.com/kubernetes/kubernetes/pull/76161">#76161</a>, <a href="https://github.com/liggitt">@liggitt</a>)</li>
<li>Added <code>kubeadm alpha certs certificate-key</code> command to generate secure random key to use on <code>kubeadm init --experimental-upload-certs</code> (<a href="https://github.com/kubernetes/kubernetes/pull/77848">#77848</a>, <a href="https://github.com/yagonobre">@yagonobre</a>)</li>
<li>Kubernetes now supports printing the <code>volumeMode</code> using <code>kubectl get pv/pvc -o wide</code> (<a href="https://github.com/kubernetes/kubernetes/pull/76646">#76646</a>, <a href="https://github.com/cwdsuzhou">@cwdsuzhou</a>)</li>
<li>Created a new <code>kubectl rollout restart</code> command that does a rolling restart of a deployment. (<a href="https://github.com/kubernetes/kubernetes/pull/76062">#76062</a>, <a href="https://github.com/apelisse">@apelisse</a>)</li>
<li><code>kubectl exec</code> now allows using the resource name to select a matching pod and <code>--pod-running-timeout</code> flag to wait till at least one pod is running. (<a href="https://github.com/kubernetes/kubernetes/pull/73664">#73664</a>, <a href="https://github.com/prksu">@prksu</a>)</li>
<li><code>kubeadm alpha certs renew</code> and <code>kubeadm upgrade</code> now supports renewal of certificates embedded in KubeConfig files managed by kubeadm; this does not apply to certificates signed by external CAs.  (<a href="https://github.com/kubernetes/kubernetes/pull/77180">#77180</a>, <a href="https://github.com/fabriziopandini">@fabriziopandini</a>)</li>
<li>Kubeadm: a new command <code>kubeadm alpha certs check-expiration</code> was created in order to help users in managing expiration for local PKI certificates (<a href="https://github.com/kubernetes/kubernetes/pull/77863">#77863</a>, <a href="https://github.com/fabriziopandini">@fabriziopandini</a>)</li>
</ul>

<h3 id="misc">Misc</h3>

<ul>
<li>Service account controller clients to now use the TokenRequest API, and tokens are periodically rotated. (<a href="https://github.com/kubernetes/kubernetes/pull/72179">#72179</a>, <a href="https://github.com/WanLinghao">@WanLinghao</a>)</li>
<li>Added <code>ListPager.EachListItem</code> utility function to client-go to enable incremental processing of chunked list responses (<a href="https://github.com/kubernetes/kubernetes/pull/75849">#75849</a>, <a href="https://github.com/jpbetz">@jpbetz</a>)</li>
<li>Object count quota is now supported for namespaced custom resources using the <code>count/&lt;resource&gt;.&lt;group&gt;</code> syntax. (<a href="https://github.com/kubernetes/kubernetes/pull/72384">#72384</a>, <a href="https://github.com/zhouhaibing089">@zhouhaibing089</a>)</li>
<li>Added completed job status in Cron Job event. (<a href="https://github.com/kubernetes/kubernetes/pull/75712">#75712</a>, <a href="https://github.com/danielqsj">@danielqsj</a>)</li>
<li>Pod disruption budgets can now be updated and patched. (<a href="https://github.com/kubernetes/kubernetes/pull/69867">#69867</a>, <a href="https://github.com/davidmccormick">@davidmccormick</a>)</li>
<li>Add CRD spec.preserveUnknownFields boolean, defaulting to true in v1beta1 and to false in v1 CRDs. If false, fields not specified in the validation schema will be removed when sent to the API server or when read from etcd. (<a href="https://github.com/kubernetes/kubernetes/pull/77333">#77333</a>, <a href="https://github.com/sttts">@sttts</a>)</li>
<li>Added RuntimeClass restrictions and defaulting to PodSecurityPolicy. (<a href="https://github.com/kubernetes/kubernetes/pull/73795">#73795</a>, <a href="https://github.com/tallclair">@tallclair</a>)</li>
<li>Kubelet plugin registration now has retry and exponential backoff logic for when registration of plugins (such as CSI or device plugin) fail. (<a href="https://github.com/kubernetes/kubernetes/pull/73891">#73891</a>, <a href="https://github.com/taragu">@taragu</a>)</li>
<li>proxy/transport now supports Content-Encoding: deflate (<a href="https://github.com/kubernetes/kubernetes/pull/76551">#76551</a>, <a href="https://github.com/JieJhih">@JieJhih</a>)</li>
<li>Admission webhooks are now properly called for <code>scale</code> and <code>deployments/rollback</code> subresources. (<a href="https://github.com/kubernetes/kubernetes/pull/76849">#76849</a>, <a href="https://github.com/liggitt">@liggitt</a>)</li>
</ul>

<h2 id="api-changes">API Changes</h2>

<ul>
<li>CRDs get support for x-kubernetes-int-or-string to allow faithful representation of IntOrString types in CustomResources.(<a href="https://github.com/kubernetes/kubernetes/pull/78815">#78815</a>, <a href="https://github.com/sttts">@sttts</a>)</li>
<li>Introduced the <a href="https://docs.google.com/document/d/1XnP67oO1i9VcDIpw42IzptnJsc5OQM-HTf8cVcjCR2w/edit"><code>v1beta2</code></a> config format to kubeadm. (<a href="https://github.com/kubernetes/kubernetes/pull/76710">#76710</a>, <a href="https://github.com/rosti">@rosti</a>)</li>
<li>Resource list requests for <code>PartialObjectMetadata</code> now correctly return list metadata like the resourceVersion and the continue token. (<a href="https://github.com/kubernetes/kubernetes/pull/75971">#75971</a>, <a href="https://github.com/smarterclayton">@smarterclayton</a>)</li>
<li>Added a condition <code>NonStructuralSchema</code> to <code>CustomResourceDefinition</code> listing Structural Schema violations as defined in the <a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-api-machinery/20190425-structural-openapi.md">KEP</a>. CRD authors should update their validation schemas to be structural in order to participate in future CRD features. (<a href="https://github.com/kubernetes/kubernetes/pull/77207">#77207</a>, <a href="https://github.com/sttts">@sttts</a>)</li>
<li>Promoted meta.k8s.io/v1beta1 Table and PartialObjectMetadata to v1. (<a href="https://github.com/kubernetes/kubernetes/pull/77136">#77136</a>, <a href="https://github.com/smarterclayton">@smarterclayton</a>)</li>
<li>Introduced the flag <code>--ipvs-strict-arp</code> to configure stricter ARP sysctls, defaulting to false to preserve existing behaviors. This was enabled by default in 1.13.0, which impacted a few CNI plugins. (<a href="https://github.com/kubernetes/kubernetes/pull/75295">#75295</a>, <a href="https://github.com/lbernail">@lbernail</a>)</li>
<li>CRD validation schemas should not specify <code>metadata</code> fields other than <code>name</code> and <code>generateName</code>. A schema will not be considered structural (and therefore ready for future features) if <code>metadata</code> is specified in any other way. (<a href="https://github.com/kubernetes/kubernetes/pull/77653">#77653</a>, <a href="https://github.com/sttts">@sttts</a>)</li>
</ul>

<h2 id="other-notable-changes">Other notable changes</h2>

<h3 id="api-machinery-1">API Machinery</h3>

<ul>
<li>Added port configuration to Admission webhook configuration service reference.</li>
<li>Added port configuration to AuditSink webhook configuration service reference.</li>
<li>Added port configuration to CRD Conversion webhook configuration service reference.</li>
<li>Added port configuration to kube-aggregator service reference. (<a href="https://github.com/kubernetes/kubernetes/pull/74855">#74855</a>, <a href="https://github.com/mbohlool">@mbohlool</a>)</li>
<li>Implemented deduplication logic for v1beta1.Event API (<a href="https://github.com/kubernetes/kubernetes/pull/65782">#65782</a>, <a href="https://github.com/yastij">@yastij</a>)</li>
<li>Added <code>objectSelector</code> to admission webhook configurations. <code>objectSelector</code> is evaluated the oldObject and newObject that would be sent to the webhook, and is considered to match if either object matches the selector. A null object (oldObject in the case of create, or newObject in the case of delete) or an object that cannot have labels (like a DeploymentRollback or a PodProxyOptions object) is not considered to match. Use the object selector only if the webhook is opt-in, because end users may skip the admission webhook by setting the labels. (<a href="https://github.com/kubernetes/kubernetes/pull/78505">#78505</a>, <a href="https://github.com/caesarxuchao">@caesarxuchao</a>)</li>
<li>Watch will now support converting response objects into Table or PartialObjectMetadata forms. (<a href="https://github.com/kubernetes/kubernetes/pull/71548">#71548</a>, <a href="https://github.com/smarterclayton">@smarterclayton</a>)</li>
<li>In CRD webhook conversion, Kubernetes will now ignore changes to metadata other than for labels and annotations. (<a href="https://github.com/kubernetes/kubernetes/pull/77743">#77743</a>, <a href="https://github.com/sttts">@sttts</a>)</li>
<li>Added ListMeta.RemainingItemCount. When responding to a LIST request, if the server has more data available, and if the request does not contain label selectors or field selectors, the server sets the ListOptions.RemainingItemCount to the number of remaining objects. (<a href="https://github.com/kubernetes/kubernetes/pull/75993">#75993</a>, <a href="https://github.com/caesarxuchao">@caesarxuchao</a>)</li>

<li><p>Clients may now request that API objects are converted to the <code>v1.Table</code> and <code>v1.PartialObjectMetadata</code> forms for generic access to objects. (<a href="https://github.com/kubernetes/kubernetes/pull/77448">#77448</a>, <a href="https://github.com/smarterclayton">@smarterclayton</a>)</p></li>

<li><p>Fixed a spurious error where update requests to the status subresource of multi-version custom resources would complain about an incorrect API version. (<a href="https://github.com/kubernetes/kubernetes/pull/78713">#78713</a>, <a href="https://github.com/liggitt">@liggitt</a>)</p></li>

<li><p>Fixed a bug in apiserver storage that could cause just-added finalizers to be ignored immediately following a delete request, leading to premature deletion. (<a href="https://github.com/kubernetes/kubernetes/pull/77619">#77619</a>, <a href="https://github.com/caesarxuchao">@caesarxuchao</a>)</p></li>

<li><p>API requests rejected by admission webhooks which specify an http status code &lt; 400 are now assigned a 400 status code. (<a href="https://github.com/kubernetes/kubernetes/pull/77022">#77022</a>, <a href="https://github.com/liggitt">@liggitt</a>)</p></li>

<li><p>Fixed a transient error API requests for custom resources could encounter while changes to the CustomResourceDefinition were being applied. (<a href="https://github.com/kubernetes/kubernetes/pull/77816">#77816</a>, <a href="https://github.com/liggitt">@liggitt</a>)
<a href="https://github.com/smarterclayton">@smarterclayton</a>)</p></li>

<li><p>Added name validation for dynamic client methods in client-go (<a href="https://github.com/kubernetes/kubernetes/pull/75072">#75072</a>, <a href="https://github.com/lblackstone">@lblackstone</a>)</p></li>

<li><p>CustomResourceDefinition with invalid regular expression in the pattern field of OpenAPI v3 validation schemas are no longer considered structural. (<a href="https://github.com/kubernetes/kubernetes/pull/78453">#78453</a>, <a href="https://github.com/sttts">@sttts</a>)</p></li>

<li><p>API paging is now enabled by default in k8s.io/apiserver recommended options, and in k8s.io/sample-apiserver (<a href="https://github.com/kubernetes/kubernetes/pull/77278">#77278</a>, <a href="https://github.com/liggitt">@liggitt</a>)</p></li>

<li><p>Increased verbose level for local openapi aggregation logs to avoid flooding the log during normal operation (<a href="https://github.com/kubernetes/kubernetes/pull/75781">#75781</a>, <a href="https://github.com/roycaihw">@roycaihw</a>)</p></li>

<li><p>k8s.io/client-go/dynamic/dynamicinformer.NewFilteredDynamicSharedInformerFactory now honours the <code>namespace</code> argument. (<a href="https://github.com/kubernetes/kubernetes/pull/77945">#77945</a>, <a href="https://github.com/michaelfig">@michaelfig</a>)</p></li>

<li><p>client-go and kubectl no longer write cached discovery files with world-accessible file permissions. (<a href="https://github.com/kubernetes/kubernetes/pull/77874">#77874</a>, <a href="https://github.com/yuchengwu">@yuchengwu</a>)</p></li>

<li><p>Fixed an error with stuck informers when an etcd watch receives update or delete events with missing data. (<a href="https://github.com/kubernetes/kubernetes/pull/76675">#76675</a>, <a href="https://github.com/ryanmcnamara">@ryanmcnamara</a>)</p></li>

<li><p><code>DelayingQueue.ShutDown()</code> can now be invoked multiple times without causing a closed channel panic. (<a href="https://github.com/kubernetes/kubernetes/pull/77170">#77170</a>, <a href="https://github.com/smarterclayton">@smarterclayton</a>)</p></li>

<li><p>When specifying an invalid value for a label, it was not always clear which label the value was specified for. Starting with this release, the label&rsquo;s key is included in such error messages, which makes debugging easier. (<a href="https://github.com/kubernetes/kubernetes/pull/77144">#77144</a>, <a href="https://github.com/kenegozi">@kenegozi</a>)</p></li>

<li><p>Fixed a regression error when proxying responses from aggregated API servers, which could cause watch requests to hang until the first event was received. (<a href="https://github.com/kubernetes/kubernetes/pull/75887">#75887</a>, <a href="https://github.com/liggitt">@liggitt</a>)</p></li>

<li><p>Fixed a bug where dry-run is not honored for pod/eviction sub-resource. (<a href="https://github.com/kubernetes/kubernetes/pull/76969">#76969</a>, <a href="https://github.com/apelisse">@apelisse</a>)</p></li>

<li><p>DeleteOptions parameters for deletecollection endpoints are now published in the OpenAPI spec. (<a href="https://github.com/kubernetes/kubernetes/pull/77843">#77843</a>, <a href="https://github.com/roycaihw">@roycaihw</a>)</p></li>

<li><p>Active watches of custom resources now terminate properly if the CRD is modified. (<a href="https://github.com/kubernetes/kubernetes/pull/78029">#78029</a>, <a href="https://github.com/liggitt">@liggitt</a>)</p></li>

<li><p>Fixed a potential deadlock in the resource quota controller. Enabled recording partial usage info for quota objects specifying multiple resources, when only some of the resources&rsquo; usage can be determined. (<a href="https://github.com/kubernetes/kubernetes/pull/74747">#74747</a>, <a href="https://github.com/liggitt">@liggitt</a>)</p></li>

<li><p>Updates that remove remaining <code>metadata.finalizers</code> from  an object that is pending deletion (non-nil metadata.deletionTimestamp) and has no graceful deletion pending (nil or 0 metadata.deletionGracePeriodSeconds) now results in immediate deletion of the object. (<a href="https://github.com/kubernetes/kubernetes/pull/77952">#77952</a>, <a href="https://github.com/liggitt">@liggitt</a>)</p></li>

<li><p>client-go: The <code>rest.AnonymousClientConfig(*rest.Config) *rest.Config</code> helper method no longer copies custom <code>Transport</code> and <code>WrapTransport</code> fields, because those can be used to inject user credentials. (<a href="https://github.com/kubernetes/kubernetes/pull/75771">#75771</a>, <a href="https://github.com/liggitt">@liggitt</a>)</p></li>

<li><p>Validating admission webhooks are now properly called for CREATE operations on the following resources: pods/binding, pods/eviction, bindings (<a href="https://github.com/kubernetes/kubernetes/pull/76910">#76910</a>, <a href="https://github.com/liggitt">@liggitt</a>)</p></li>

<li><p>Removed the function Parallelize, please convert to use the function ParallelizeUntil. (<a href="https://github.com/kubernetes/kubernetes/pull/76595">#76595</a>, <a href="https://github.com/danielqsj">@danielqsj</a>)</p></li>
</ul>

<h3 id="apps-1">Apps</h3>

<ul>
<li>Users can now specify a DataSource/Kind of type <code>PersistentVolumeClaim</code> in their PVC spec.  This can then be detected by the external csi-provisioner and plugins if capable. (<a href="https://github.com/kubernetes/kubernetes/pull/76913">#76913</a>, <a href="https://github.com/j-griffith">@j-griffith</a>)</li>
<li>Fixed bug in DaemonSetController causing it to stop processing some DaemonSets for 5 minutes after node removal. (<a href="https://github.com/kubernetes/kubernetes/pull/76060">#76060</a>, <a href="https://github.com/krzysztof-jastrzebski">@krzysztof-jastrzebski</a>)</li>
<li>StatefulSet controllers no longer force a resync every 30 seconds when nothing has changed. (<a href="https://github.com/kubernetes/kubernetes/pull/75622">#75622</a>, <a href="https://github.com/jonsabo">@jonsabo</a>)</li>
<li>Enhanced the daemonset sync logic to avoid a problem where pods are thought to be unavailable when the controller&rsquo;s clock is slower than the node&rsquo;s clock. (<a href="https://github.com/kubernetes/kubernetes/pull/77208">#77208</a>, <a href="https://github.com/DaiHao">@DaiHao</a>)</li>
<li>Fixed a bug that caused a DaemonSet rolling update to hang when its pod gets stuck at terminating.  (<a href="https://github.com/kubernetes/kubernetes/pull/77773">#77773</a>, <a href="https://github.com/DaiHao">@DaiHao</a>)</li>
<li>Route controller now respects rate limiting to the cloud provider on deletion; previously it was only for create. (<a href="https://github.com/kubernetes/kubernetes/pull/78581">#78581</a>, <a href="https://github.com/andrewsykim">@andrewsykim</a>)</li>
<li>Removed extra pod creation expectations when daemonset fails to create pods in batches. (<a href="https://github.com/kubernetes/kubernetes/pull/74856">#74856</a>, <a href="https://github.com/draveness">@draveness</a>)</li>
<li>Resolved spurious rollouts of workload controllers when upgrading the API server, due to incorrect defaulting of an alpha procMount field in pods. (<a href="https://github.com/kubernetes/kubernetes/pull/78885">#78885</a>, <a href="https://github.com/liggitt">@liggitt</a>)</li>
</ul>

<h3 id="auth-1">Auth</h3>

<ul>
<li>Fixed OpenID Connect (OIDC) token refresh when the client secret contains a special character. (<a href="https://github.com/kubernetes/kubernetes/pull/76914">#76914</a>, <a href="https://github.com/tsuna">@tsuna</a>)</li>
<li>Improved <code>kubectl auth can-i</code> command by warning users when they try to access a resource out of scope. (<a href="https://github.com/kubernetes/kubernetes/pull/76014">#76014</a>, <a href="https://github.com/WanLinghao">@WanLinghao</a>)</li>
<li>Validating admission webhooks are now properly called for CREATE operations on the following resources: tokenreviews, subjectaccessreviews, localsubjectaccessreviews, selfsubjectaccessreviews, selfsubjectrulesreviews (<a href="https://github.com/kubernetes/kubernetes/pull/76959">#76959</a>, <a href="https://github.com/sbezverk">@sbezverk</a>)</li>
</ul>

<h3 id="autoscaling">Autoscaling</h3>

<ul>
<li><p>Horizontal Pod Autoscaling can now scale targets up even when one or more metrics are invalid/unavailable, as long as one metric indicates a scale up should occur. (<a href="https://github.com/kubernetes/kubernetes/pull/78503">#78503</a>, <a href="https://github.com/gjtempleton">@gjtempleton</a>)</p></li>

<li><p>Kubernetes will now use the zone from the node for topology aware aws-ebs volume creation to reduce unnecessary cloud provider calls. (<a href="https://github.com/kubernetes/kubernetes/pull/78276">#78276</a>, <a href="https://github.com/zhan849">@zhan849</a>)</p></li>

<li><p>Kubernetes now supports configure accessLogs for AWS NLB. (<a href="https://github.com/kubernetes/kubernetes/pull/78497">#78497</a>, <a href="https://github.com/M00nF1sh">@M00nF1sh</a>)</p></li>

<li><p>Kubernetes now supports update LoadBalancerSourceRanges for AWS NLB(<a href="https://github.com/kubernetes/kubernetes/pull/74692">#74692</a>, <a href="https://github.com/M00nF1sh">@M00nF1sh</a>)</p></li>

<li><p>Kubernetes now supports configure TLS termination for AWS NLB(<a href="https://github.com/kubernetes/kubernetes/pull/74910">#74910</a>, <a href="https://github.com/M00nF1sh">@M00nF1sh</a>)</p></li>

<li><p>Kubernetes will now consume the AWS region list from the AWS SDK instead of a hard-coded list in the cloud provider. (<a href="https://github.com/kubernetes/kubernetes/pull/75990">#75990</a>, <a href="https://github.com/mcrute">@mcrute</a>)</p></li>

<li><p>Limit use of tags when calling EC2 API to prevent API throttling for very large clusters. (<a href="https://github.com/kubernetes/kubernetes/pull/76749">#76749</a>, <a href="https://github.com/mcrute">@mcrute</a>)</p></li>

<li><p>The AWS credential provider can now obtain ECR credentials even without the AWS cloud provider or being on an EC2 instance. Additionally, AWS credential provider caching has been improved to honor the ECR credential timeout. (<a href="https://github.com/kubernetes/kubernetes/pull/75587">#75587</a>, <a href="https://github.com/tiffanyfay">@tiffanyfay</a>)</p></li>

<li><p>Kubernetes now supports specifying the Resource Group of the Route Table when updating the Pod network route on Azure. (<a href="https://github.com/kubernetes/kubernetes/pull/75580">#75580</a>, <a href="https://github.com/suker200">@suker200</a>)</p></li>

<li><p>Kubernetes now uses instance-level update APIs for Azure VMSS loadbalancer operations. (<a href="https://github.com/kubernetes/kubernetes/pull/76656">#76656</a>, <a href="https://github.com/feiskyer">@feiskyer</a>)</p></li>

<li><p>Users can now specify azure file share name in the azure file plugin, making it possible to use existing shares or specify a new share name. (<a href="https://github.com/kubernetes/kubernetes/pull/76988">#76988</a>, <a href="https://github.com/andyzhangx">@andyzhangx</a>)</p></li>

<li><p>You can now run kubelet with no Azure identity. A sample cloud provider configuration is:  <code>{&quot;vmType&quot;: &quot;vmss&quot;, &quot;useInstanceMetadata&quot;: true, &quot;subscriptionId&quot;: &quot;&lt;subscriptionId&gt;&quot;}</code> (<a href="https://github.com/kubernetes/kubernetes/pull/77906">#77906</a>, <a href="https://github.com/feiskyer">@feiskyer</a>)</p></li>

<li><p>Fixed some service tags not supported issues for Azure LoadBalancer service. (<a href="https://github.com/kubernetes/kubernetes/pull/77719">#77719</a>, <a href="https://github.com/feiskyer">@feiskyer</a>)</p></li>

<li><p>Fixed an issue where <code>pull image</code> fails from a cross-subscription Azure Container Registry when using MSI to authenticate. (<a href="https://github.com/kubernetes/kubernetes/pull/77245">#77245</a>, <a href="https://github.com/norshtein">@norshtein</a>)</p></li>

<li><p>Azure cloud provider can now be configured by Kubernetes secrets and a new option <code>cloudConfigType</code> has been introduced. Candidate values are <code>file</code>, <code>secret</code> or <code>merge</code> (default is <code>merge</code>). Note that the secret is a serialized version of <code>azure.json</code> file with key cloud-config. And the secret name is azure-cloud-provider in kube-system namespace. (<a href="https://github.com/kubernetes/kubernetes/pull/78242">#78242</a>, <a href="https://github.com/feiskyer">@feiskyer</a>)</p></li>
</ul>

<h3 id="cli-1">CLI</h3>

<ul>
<li>Fixed <code>kubectl exec</code> usage string to correctly reflect flag placement. (<a href="https://github.com/kubernetes/kubernetes/pull/77589">#77589</a>, <a href="https://github.com/soltysh">@soltysh</a>)</li>
<li>Fixed <code>kubectl describe cronjobs</code> error of <code>Successful Job History Limit</code>. (<a href="https://github.com/kubernetes/kubernetes/pull/77347">#77347</a>, <a href="https://github.com/danielqsj">@danielqsj</a>)</li>
<li>In the <code>kubectl describe</code> output, the fields with names containing special characters are now displayed as-is without any pretty formatting, avoiding awkward outputs.  (<a href="https://github.com/kubernetes/kubernetes/pull/75483">#75483</a>, <a href="https://github.com/gsadhani">@gsadhani</a>)</li>
<li>Fixed incorrect handling by kubectl of custom resources whose Kind is &ldquo;Status&rdquo;. (<a href="https://github.com/kubernetes/kubernetes/pull/77368">#77368</a>, <a href="https://github.com/liggitt">@liggitt</a>)</li>
<li>Report cp errors consistently, providing full message whether copying to or from a pod.  (<a href="https://github.com/kubernetes/kubernetes/pull/77010">#77010</a>, <a href="https://github.com/soltysh">@soltysh</a>)</li>
<li>Preserved existing namespace information in manifests when running <code>
set ... --local</code> commands. (<a href="https://github.com/kubernetes/kubernetes/pull/77267">#77267</a>, <a href="https://github.com/liggitt">@liggitt</a>)</li>
<li>Support for parsing more v1.Taint forms has been added. For example, <code>key:effect</code>, <code>key=:effect-</code> are now accepted. (<a href="https://github.com/kubernetes/kubernetes/pull/74159">#74159</a>, <a href="https://github.com/dlipovetsky">@dlipovetsky</a>)</li>
</ul>

<h3 id="cloud-provider">Cloud Provider</h3>

<ul>
<li>The GCE-only flag <code>cloud-provider-gce-lb-src-cidrs</code> is now optional for external cloud providers. (<a href="https://github.com/kubernetes/kubernetes/pull/76627">#76627</a>, <a href="https://github.com/timoreimann">@timoreimann</a>)</li>
<li>Fixed a bug where cloud-controller-manager initializes nodes multiple times. (<a href="https://github.com/kubernetes/kubernetes/pull/75405">#75405</a>, <a href="https://github.com/tghartland">@tghartland</a>)</li>
</ul>

<h3 id="cluster-lifecycle">Cluster Lifecycle</h3>

<ul>
<li><code>kubeadm upgrade</code> now renews all the certificates used by a component before upgrading the component itself, with the exception of certificates signed by external CAs. User can eventually opt-out of certificate renewal during upgrades by setting the new flag <code>--certificate-renewal</code> to false. (<a href="https://github.com/kubernetes/kubernetes/pull/76862">#76862</a>, <a href="https://github.com/fabriziopandini">@fabriziopandini</a>)</li>
<li>kubeadm still generates RSA keys when deploying a node, but also accepts ECDSA
keys if they already exist in the directory specified in the <code>--cert-dir</code> option. (<a href="https://github.com/kubernetes/kubernetes/pull/76390">#76390</a>, <a href="https://github.com/rojkov">@rojkov</a>)</li>
<li>kubeadm now implements CRI detection for Windows worker nodes (<a href="https://github.com/kubernetes/kubernetes/pull/78053">#78053</a>, <a href="https://github.com/ksubrmnn">@ksubrmnn</a>)</li>

<li><p>Added <code>--image-repository</code> flag to <code>kubeadm config images</code>. (<a href="https://github.com/kubernetes/kubernetes/pull/75866">#75866</a>, <a href="https://github.com/jmkeyes">@jmkeyes</a>)</p></li>

<li><p>kubeadm: The kubeadm reset command has now been exposed as phases. (<a href="https://github.com/kubernetes/kubernetes/pull/77847">#77847</a>, <a href="https://github.com/yagonobre">@yagonobre</a>)</p></li>

<li><p>kubeadm: Improved resiliency when it comes to updating the <code>kubeadm-config</code> configmap upon new control plane joins or resets. This allows for safe multiple control plane joins and/or resets. (<a href="https://github.com/kubernetes/kubernetes/pull/76821">#76821</a>, <a href="https://github.com/ereslibre">@ereslibre</a>)</p></li>

<li><p>kubeadm: Bumped the minimum supported Docker version to 1.13.1 (<a href="https://github.com/kubernetes/kubernetes/pull/77051">#77051</a>, <a href="https://github.com/chenzhiwei">@chenzhiwei</a>)</p></li>

<li><p>Reverted the CoreDNS version to 1.3.1 for kubeadm (<a href="https://github.com/kubernetes/kubernetes/pull/78545">#78545</a>, <a href="https://github.com/neolit123">@neolit123</a>)</p></li>

<li><p>kubeadm: Fixed the machine readability of <code>kubeadm token create --print-join-command</code> (<a href="https://github.com/kubernetes/kubernetes/pull/75487">#75487</a>, <a href="https://github.com/displague">@displague</a>)</p></li>

<li><p><code>kubeadm alpha certs renew --csr-only</code> now reads the current certificates as the authoritative source for certificates attributes (same as kubeadm alpha certs renew). (<a href="https://github.com/kubernetes/kubernetes/pull/77780">#77780</a>, <a href="https://github.com/fabriziopandini">@fabriziopandini</a>)</p></li>

<li><p>kubeadm: You can now delete multiple bootstrap tokens at once. (<a href="https://github.com/kubernetes/kubernetes/pull/75646">#75646</a>, <a href="https://github.com/bart0sh">@bart0sh</a>)</p></li>

<li><p>util/initsystem: Added support for the OpenRC init system (<a href="https://github.com/kubernetes/kubernetes/pull/73101">#73101</a>, <a href="https://github.com/oz123">@oz123</a>)</p></li>

<li><p>Default TTL for DNS records in kubernetes zone has been changed from 5s to 30s to keep consistent with old dnsmasq based kube-dns. The TTL can be customized with command <code>kubectl edit -n kube-system configmap/coredns</code>. (<a href="https://github.com/kubernetes/kubernetes/pull/76238">#76238</a>, <a href="https://github.com/Dieken">@Dieken</a>)</p></li>

<li><p>Communication between the etcd server and kube-apiserver on master is now overridden to use HTTPS instead of HTTP when mTLS is enabled in GCE. (<a href="https://github.com/kubernetes/kubernetes/pull/74690">#74690</a>, <a href="https://github.com/wenjiaswe">@wenjiaswe</a>)</p></li>
</ul>

<h3 id="gcp">GCP</h3>

<ul>
<li>[stackdriver addon] Bumped prometheus-to-sd to v0.5.0 to pick up security fixes.
[fluentd-gcp addon] Bumped fluentd-gcp-scaler to v0.5.1 to pick up security fixes.
[fluentd-gcp addon] Bumped event-exporter to v0.2.4 to pick up security fixes.
[fluentd-gcp addon] Bumped prometheus-to-sd to v0.5.0 to pick up security fixes.
[metatada-proxy addon] Bumped prometheus-to-sd v0.5.0 to pick up security fixes. (<a href="https://github.com/kubernetes/kubernetes/pull/75362">#75362</a>, <a href="https://github.com/serathius">@serathius</a>)</li>
<li>[fluentd-gcp addon] Bump fluentd-gcp-scaler to v0.5.2 to pick up security fixes. (<a href="https://github.com/kubernetes/kubernetes/pull/76762">#76762</a>, <a href="https://github.com/serathius">@serathius</a>)</li>
<li>The GCERegionalPersistentDisk feature gate (GA in 1.13) can no longer be disabled. The feature gate will be removed in v1.17. (<a href="https://github.com/kubernetes/kubernetes/pull/77412">#77412</a>, <a href="https://github.com/liggitt">@liggitt</a>)</li>
<li>GCE/Windows: When the service cannot be stopped Stackdriver logging processes are now force killed (<a href="https://github.com/kubernetes/kubernetes/pull/77378">#77378</a>, <a href="https://github.com/yujuhong">@yujuhong</a>)</li>
<li>Reduced GCE log rotation check from 1 hour to every 5 minutes.  Rotation policy is unchanged (new day starts, log file size &gt; 100MB). (<a href="https://github.com/kubernetes/kubernetes/pull/76352">#76352</a>, <a href="https://github.com/jpbetz">@jpbetz</a>)</li>
<li>GCE/Windows: disabled stackdriver logging agent to prevent node startup failures (<a href="https://github.com/kubernetes/kubernetes/pull/76099">#76099</a>, <a href="https://github.com/yujuhong">@yujuhong</a>)</li>
<li>API servers using the default Google Compute Engine bootstrapping scripts will have their insecure port (<code>:8080</code>) disabled by default. To enable the insecure port, set <code>ENABLE_APISERVER_INSECURE_PORT=true</code> in kube-env or as an environment variable. (<a href="https://github.com/kubernetes/kubernetes/pull/77447">#77447</a>, <a href="https://github.com/dekkagaijin">@dekkagaijin</a>)</li>
<li>Fixed a NPD bug on GCI, so that it disables glog writing to files for log-counter. (<a href="https://github.com/kubernetes/kubernetes/pull/76211">#76211</a>, <a href="https://github.com/wangzhen127">@wangzhen127</a>)</li>
<li>Windows nodes on GCE now have the Windows firewall enabled by default. (<a href="https://github.com/kubernetes/kubernetes/pull/78507">#78507</a>, <a href="https://github.com/pjh">@pjh</a>)</li>
<li>Added <code>CNI_VERSION</code> and <code>CNI_SHA1</code> environment variables in <code>kube-up.sh</code> to configure CNI versions on GCE. (<a href="https://github.com/kubernetes/kubernetes/pull/76353">#76353</a>, <a href="https://github.com/Random-Liu">@Random-Liu</a>)</li>
<li>GCE clusters will include some IP ranges that are not used on the public Internet in the list of non-masq IPs. Bumped ip-masq-agent version to v2.3.0 with flag <code>nomasq-all-reserved-ranges</code> turned on. (<a href="https://github.com/kubernetes/kubernetes/pull/77458">#77458</a>, <a href="https://github.com/grayluck">@grayluck</a>)</li>
<li>GCE/Windows: added support for the stackdriver logging agent (<a href="https://github.com/kubernetes/kubernetes/pull/76850">#76850</a>, <a href="https://github.com/yujuhong">@yujuhong</a>)</li>
<li>GCE Windows nodes will rely solely on kubernetes and kube-proxy (and not the GCE agent) for network address management. (<a href="https://github.com/kubernetes/kubernetes/pull/75855">#75855</a>, <a href="https://github.com/pjh">@pjh</a>)</li>
<li>Ensured that the <code>node-role.kubernetes.io/master</code> taint is applied to the master with NoSchedule on GCE. (<a href="https://github.com/kubernetes/kubernetes/pull/78183">#78183</a>, <a href="https://github.com/cheftako">@cheftako</a>)</li>
<li>Windows nodes on GCE now use a known-working 1809 image rather than the latest 1809 image. (<a href="https://github.com/kubernetes/kubernetes/pull/76722">#76722</a>, <a href="https://github.com/pjh">@pjh</a>)</li>
<li>kube-up.sh scripts now disable the KubeletPodResources feature for Windows nodes, due to issue #<a href="https://github.com/kubernetes/kubernetes/pull/78668">78628</a>. (<a href="https://github.com/kubernetes/kubernetes/pull/78668">#78668</a>, <a href="https://github.com/mtaufen">@mtaufen</a>)</li>
</ul>

<h3 id="instrumentation">Instrumentation</h3>

<ul>
<li>[metrics-server addon] Restored the ability to connect to nodes via IP addresses. (<a href="https://github.com/kubernetes/kubernetes/pull/76819">#76819</a>, <a href="https://github.com/serathius">@serathius</a>)</li>
<li>If a pod has a running instance, the stats of its previously terminated instances will not show up in the kubelet summary stats any more for CRI runtimes such as containerd and cri-o. This keeps the behavior consistent with Docker integration, and fixes an issue that some container Prometheus metrics don&rsquo;t work when there are summary stats for multiple instances of the same pod. (<a href="https://github.com/kubernetes/kubernetes/pull/77426">#77426</a>, <a href="https://github.com/Random-Liu">@Random-Liu</a>)</li>
</ul>

<h3 id="network-1">Network</h3>

<ul>
<li>Ingress objects are now persisted in etcd using the networking.k8s.io/v1beta1 version (<a href="https://github.com/kubernetes/kubernetes/pull/77139">#77139</a>, <a href="https://github.com/cmluciano">@cmluciano</a>)</li>
<li>Transparent kube-proxy restarts when using IPVS are now allowed. (<a href="https://github.com/kubernetes/kubernetes/pull/75283">#75283</a>, <a href="https://github.com/lbernail">@lbernail</a>)</li>
<li>Packets considered INVALID by conntrack are now dropped. In particular, this fixes
a problem where spurious retransmits in a long-running TCP connection to a service
IP could result in the connection being closed with the error &ldquo;Connection reset by
peer&rdquo; (<a href="https://github.com/kubernetes/kubernetes/pull/74840">#74840</a>, <a href="https://github.com/anfernee">@anfernee</a>)</li>
<li>kube-proxy no longer automatically cleans up network rules created by running kube-proxy in other modes. If you are switching the kube-proxy mode (EG: iptables to IPVS), you will need to run <code>kube-proxy --cleanup</code>, or restart the worker node (recommended) before restarting kube-proxy. If you are not switching kube-proxy between different modes, this change should not require any action. (<a href="https://github.com/kubernetes/kubernetes/pull/76109">#76109</a>, <a href="https://github.com/vllry">@vllry</a>)</li>
<li>kube-proxy: HealthzBindAddress and MetricsBindAddress now support ipv6 addresses. (<a href="https://github.com/kubernetes/kubernetes/pull/76320">#76320</a>, <a href="https://github.com/JieJhih">@JieJhih</a>)</li>

<li><p>The userspace proxy now respects the IPTables proxy&rsquo;s minSyncInterval parameter. (<a href="https://github.com/kubernetes/kubernetes/pull/71735">#71735</a>, <a href="https://github.com/dcbw">@dcbw</a>)</p></li>

<li><p>iptables proxier: now routes local traffic to LB IPs to service chain (<a href="https://github.com/kubernetes/kubernetes/pull/77523">#77523</a>, <a href="https://github.com/andrewsykim">@andrewsykim</a>)</p></li>

<li><p>IPVS: Disabled graceful termination for UDP traffic to solve issues with high number of UDP connections (DNS / syslog in particular) (<a href="https://github.com/kubernetes/kubernetes/pull/77802">#77802</a>, <a href="https://github.com/lbernail">@lbernail</a>)</p></li>

<li><p>Fixed a bug where kube-proxy returns error due to existing ipset rules using a different hash type. (<a href="https://github.com/kubernetes/kubernetes/pull/77371">#77371</a>, <a href="https://github.com/andrewsykim">@andrewsykim</a>)</p></li>

<li><p>Fixed spurious error messages about failing to clean up iptables rules when using iptables 1.8. (<a href="https://github.com/kubernetes/kubernetes/pull/77303">#77303</a>, <a href="https://github.com/danwinship">@danwinship</a>)</p></li>

<li><p>Increased log level to 2 for IPVS graceful termination (<a href="https://github.com/kubernetes/kubernetes/pull/78395">#78395</a>, <a href="https://github.com/andrewsykim">@andrewsykim</a>)</p></li>

<li><p>kube-proxy: os exit when CleanupAndExit is set to true (<a href="https://github.com/kubernetes/kubernetes/pull/76732">#76732</a>, <a href="https://github.com/JieJhih">@JieJhih</a>)</p></li>

<li><p>Kubernetes will now allow trailing dots in the externalName of Services of type ExternalName. (<a href="https://github.com/kubernetes/kubernetes/pull/78385">#78385</a>, <a href="https://github.com/thz">@thz</a>)</p></li>
</ul>

<h3 id="node-1">Node</h3>

<ul>
<li>The dockershim container runtime now accepts the <code>docker</code> runtime handler from a RuntimeClass. (<a href="https://github.com/kubernetes/kubernetes/pull/78323">#78323</a>, <a href="https://github.com/tallclair">@tallclair</a>)</li>
<li>The init container can now get its own field value as environment variable values using downwardAPI support. (<a href="https://github.com/kubernetes/kubernetes/pull/75109">#75109</a>, <a href="https://github.com/yuchengwu">@yuchengwu</a>)</li>
<li>UpdateContainerResources is no longer recorded as a <code>container_status</code> operation. It now uses the label <code>update_container</code>. (<a href="https://github.com/kubernetes/kubernetes/pull/75278">#75278</a>, <a href="https://github.com/Nessex">@Nessex</a>)</li>
<li>kubelet: fix fail to close kubelet-&gt;API connections on heartbeat failure when bootstrapping or client certificate rotation is disabled (<a href="https://github.com/kubernetes/kubernetes/pull/78016">#78016</a>, <a href="https://github.com/gaorong">@gaorong</a>)</li>
<li>Set selinux label at plugin socket directory (<a href="https://github.com/kubernetes/kubernetes/pull/73241">#73241</a>, <a href="https://github.com/vikaschoudhary16">@vikaschoudhary16</a>)</li>
<li>Fixed detection of non-root image user ID.(<a href="https://github.com/kubernetes/kubernetes/pull/78261">#78261</a>, <a href="https://github.com/tallclair">@tallclair</a>)</li>
<li>Signal handling is now initialized within hyperkube commands that require it, such as apiserver and kubelet. (<a href="https://github.com/kubernetes/kubernetes/pull/76659">#76659</a>, <a href="https://github.com/S-Chan">@S-Chan</a>)</li>
<li>The Kubelet now properly requests protobuf objects where they are supported from the apiserver, reducing load in large clusters. (<a href="https://github.com/kubernetes/kubernetes/pull/75602">#75602</a>, <a href="https://github.com/smarterclayton">@smarterclayton</a>)</li>
</ul>

<h3 id="openstack">OpenStack</h3>

<ul>
<li>You can now define a kubeconfig file for the OpenStack cloud provider. (<a href="https://github.com/kubernetes/kubernetes/pull/77415">#77415</a>, <a href="https://github.com/Fedosin">@Fedosin</a>)</li>
<li>OpenStack user credentials can now be read from a secret instead of a local config file. (<a href="https://github.com/kubernetes/kubernetes/pull/75062">#75062</a>, <a href="https://github.com/Fedosin">@Fedosin</a>)</li>
</ul>

<h3 id="release">Release</h3>

<ul>
<li>Removed hyperkube short aliases from source code because hyperkube docker image currently create these aliases. (<a href="https://github.com/kubernetes/kubernetes/pull/76953">#76953</a>, <a href="https://github.com/Rand01ph">@Rand01ph</a>)</li>
</ul>

<h3 id="scheduling">Scheduling</h3>

<ul>
<li>Tolerations with the same key and effect will be merged into one that has the value of the latest toleration for best effort pods. (<a href="https://github.com/kubernetes/kubernetes/pull/75985">#75985</a>, <a href="https://github.com/ravisantoshgudimetla">@ravisantoshgudimetla</a>)</li>
<li>Achieved 2X performance improvement on both required and preferred PodAffinity. (<a href="https://github.com/kubernetes/kubernetes/pull/76243">#76243</a>, <a href="https://github.com/Huang-Wei">@Huang-Wei</a>)</li>
<li>Fixed a scheduler racing issue to ensure low priority pods are unschedulable on the node(s) where high priority pods have <code>NominatedNodeName</code> set to the node(s).  (<a href="https://github.com/kubernetes/kubernetes/pull/77990">#77990</a>, <a href="https://github.com/Huang-Wei">@Huang-Wei</a>)</li>
</ul>

<h3 id="storage-1">Storage</h3>

<ul>
<li>Fixed issue with kubelet waiting on invalid devicepath on AWS (<a href="https://github.com/kubernetes/kubernetes/pull/78595">#78595</a>, <a href="https://github.com/gnufied">@gnufied</a>)</li>
<li>StorageOS volumes now show correct mount information (node and mount time) in the StorageOS administration CLI and UI. (<a href="https://github.com/kubernetes/kubernetes/pull/78522">#78522</a>, <a href="https://github.com/croomes">@croomes</a>)</li>
<li>Fixed issue in Portworx volume driver causing controller manager to crash. (<a href="https://github.com/kubernetes/kubernetes/pull/76341">#76341</a>, <a href="https://github.com/harsh-px">@harsh-px</a>)</li>
<li>For an empty regular file, <code>stat --printf %F</code> will now display <code>regular empty file</code> instead of <code>regular file</code>. (<a href="https://github.com/kubernetes/kubernetes/pull/62159">#62159</a>, <a href="https://github.com/dixudx">@dixudx</a>)</li>
<li>You can now have different operation names for different storage operations. This still prevents two operations on same volume from happening concurrently but if the operation changes, it resets the exponential backoff.
(<a href="https://github.com/kubernetes/kubernetes/pull/75213">#75213</a>, <a href="https://github.com/gnufied">@gnufied</a>)</li>
<li>Reduced event spam for <code>AttachVolume</code> storage operation. (<a href="https://github.com/kubernetes/kubernetes/pull/75986">#75986</a>, <a href="https://github.com/mucahitkurt">@mucahitkurt</a>)</li>
<li>Until this release, the iscsi plugin was waiting 10 seconds for a path to appear in the device list. However this timeout is not enough, or is less than the default device discovery timeout in most systems, which prevents certain devices from being discovered. This timeout has been raised to 30 seconds, which should help to avoid mount issues due to device discovery. (<a href="https://github.com/kubernetes/kubernetes/pull/78475">#78475</a>, <a href="https://github.com/humblec">@humblec</a>)</li>
<li>Added a field to store CSI volume expansion secrets (<a href="https://github.com/kubernetes/kubernetes/pull/77516">#77516</a>, <a href="https://github.com/gnufied">@gnufied</a>)</li>
<li>Fixed a bug in block volume expansion. (<a href="https://github.com/kubernetes/kubernetes/pull/77317">#77317</a>, <a href="https://github.com/gnufied">@gnufied</a>)</li>

<li><p>Count PVCs that are unbound towards attach limit. (<a href="https://github.com/kubernetes/kubernetes/pull/73863">#73863</a>, <a href="https://github.com/gnufied">@gnufied</a>)</p></li>

<li><p>Kubectl port-forward for Windows containers was added in v1.15. To use it, you’ll need to build a new pause image including WinCAT. (<a href="https://github.com/kubernetes/kubernetes/pull/75479">#75479</a>, <a href="https://github.com/benmoss">@benmoss</a>)</p></li>

<li><p>We’re working to simplify the Windows node join experience with better scripts and kubeadm. Scripts and doc updates are still in the works, but some of the needed improvements are included in 1.15.  These include:</p>

<ul>
<li>Windows kube-proxy will wait for HNS network creation on start (<a href="https://github.com/kubernetes/kubernetes/pull/78612">#78612</a>, <a href="https://github.com/ksubrmnn">@ksubrmnn</a>)</li>
<li>kubeadm: implemented CRI detection for Windows worker nodes (<a href="https://github.com/kubernetes/kubernetes/pull/78053">#78053</a>, <a href="https://github.com/ksubrmnn">@ksubrmnn</a>)</li>
</ul></li>

<li><p>Worked toward support for Windows Server version 1903, including adding Windows support for preserving the destination IP as the VIP when loadbalancing with DSR. (<a href="https://github.com/kubernetes/kubernetes/pull/74825">#74825</a>, <a href="https://github.com/ksubrmnn">@ksubrmnn</a>)</p></li>

<li><p>Bug fix: Windows Kubelet nodes will now correctly search the default location for Docker credentials (<code>%USERPROFILE%\.docker\config.json</code>) when pulling images from a private registry. (<a href="https://kubernetes.io/docs/concepts/containers/images/#configuring-nodes-to-authenticate-to-a-private-registry">https://kubernetes.io/docs/concepts/containers/images/#configuring-nodes-to-authenticate-to-a-private-registry</a>) (<a href="https://github.com/kubernetes/kubernetes/pull/78528">#78528</a>, <a href="https://github.com/bclau">@bclau</a>)</p></li>
</ul>

<h2 id="dependencies">Dependencies</h2>

<h3 id="changed">Changed</h3>

<ul>
<li>The default Go version was updated to 1.12.5. (<a href="https://github.com/kubernetes/kubernetes/pull/78528">#78528</a>)</li>
<li>cri-tools has been updated to v1.14.0. (<a href="https://github.com/kubernetes/kubernetes/pull/75658">#75658</a>)</li>
<li>Cluster Autoscaler has been updated to v1.15.0. (<a href="https://github.com/kubernetes/kubernetes/pull/78866">#78866</a>)</li>
<li>Kibana has been upgraded to v6.6.1. (<a href="https://github.com/kubernetes/kubernetes/pull/71251">#71251</a>)</li>
<li>CAdvisor has been updated to v0.33.2. (<a href="https://github.com/kubernetes/kubernetes/pull/76291">#76291</a>)</li>
<li>Fluentd-gcp-scaler has been upgraded to v0.5.2. (<a href="https://github.com/kubernetes/kubernetes/pull/76762">#76762</a>)</li>
<li>Fluentd in fluentd-elasticsearch has been upgraded to v1.4.2. (<a href="https://github.com/kubernetes/kubernetes/pull/76854">#76854</a>)</li>
<li>fluentd-elasticsearch has been updated to v2.5.2. (<a href="https://github.com/kubernetes/kubernetes/pull/76854">#76854</a>)</li>
<li>event-exporter has been updated to v0.2.5. (<a href="https://github.com/kubernetes/kubernetes/pull/77815">#77815</a>)</li>
<li>es-image has been updated to Elasticsearch 6.7.2. (<a href="https://github.com/kubernetes/kubernetes/pull/77765">#77765</a>)</li>
<li>metrics-server has been updated to v0.3.3. (<a href="https://github.com/kubernetes/kubernetes/pull/77950">#77950</a>)</li>
<li>ip-masq-agent has been updated to v2.4.1. (<a href="https://github.com/kubernetes/kubernetes/pull/77844">#77844</a>)</li>
<li>addon-manager has been updated to v9.0.1 (<a href="https://github.com/kubernetes/kubernetes/pull/77282">#77282</a>)</li>
<li>go-autorest has been updated to v11.1.2 (<a href="https://github.com/kubernetes/kubernetes/pull/77070">#77070</a>)</li>
<li>klog has been updated to 0.3.0 (<a href="https://github.com/kubernetes/kubernetes/pull/76474">#76474</a>)</li>
<li>k8s-dns-node-cache image has been updated to v1.15.1 (<a href="https://github.com/kubernetes/kubernetes/pull/76640">#76640</a>, <a href="https://github.com/george-angel">@george-angel</a>)</li>
</ul>

<h3 id="unchanged">Unchanged</h3>

<ul>
<li>Default etcd server version remains unchanged at v3.3.10. The etcd client version was updated to v3.3.10. (<a href="https://github.com/kubernetes/kubernetes/pull/71615">#71615</a>, <a href="https://github.com/kubernetes/kubernetes/pull/70168">#70168</a>, <a href="https://github.com/kubernetes/kubernetes/pull/76917">#76917</a>)</li>
<li>The list of validated docker versions remains unchanged.

<ul>
<li>The current list is 1.13.1, 17.03, 17.06, 17.09, 18.06, 18.09. (<a href="https://github.com/kubernetes/kubernetes/pull/72823">#72823</a>, <a href="https://github.com/kubernetes/kubernetes/pull/72831">#72831</a>)</li>
</ul></li>
<li>CNI remains unchanged at v0.7.5. (<a href="https://github.com/kubernetes/kubernetes/pull/75455">#75455</a>)</li>
<li>CSI remains unchanged at to v1.1.0. (<a href="https://github.com/kubernetes/kubernetes/pull/75391">#75391</a>)</li>
<li>The dashboard add-on remains unchanged at v1.10.1. (<a href="https://github.com/kubernetes/kubernetes/pull/72495">#72495</a>)</li>
<li>kube-dns is unchanged at v1.14.13 as of Kubernetes 1.12. (<a href="https://github.com/kubernetes/kubernetes/pull/68900">#68900</a>)</li>
<li>Influxdb is unchanged at v1.3.3 as of Kubernetes 1.10. (<a href="https://github.com/kubernetes/kubernetes/pull/53319">#53319</a>)</li>
<li>Grafana is unchanged at v4.4.3 as of Kubernetes 1.10. (<a href="https://github.com/kubernetes/kubernetes/pull/53319">#53319</a>)</li>
<li>The fluent-plugin-kubernetes_metadata_filter plugin in fluentd-elasticsearch is unchanged at v2.1.6. (<a href="https://github.com/kubernetes/kubernetes/pull/71180">#71180</a>)</li>
<li>fluentd-gcp is unchanged at v3.2.0 as of Kubernetes 1.13. (<a href="https://github.com/kubernetes/kubernetes/pull/70954">#70954</a>)</li>
<li>OIDC authentication is unchanged at coreos/go-oidc v2 as of Kubernetes 1.10. (<a href="https://github.com/kubernetes/kubernetes/pull/58544">#58544</a>)</li>
<li>Calico is unchanged at v3.3.1 as of Kubernetes 1.13. (<a href="https://github.com/kubernetes/kubernetes/pull/70932">#70932</a>)</li>
<li>crictl on GCE was updated to v1.14.0. (<a href="https://github.com/kubernetes/kubernetes/pull/75658">#75658</a>)</li>
<li>CoreDNS is unchanged at v1.3.1 as of Kubernetes 1.14. (<a href="https://github.com/kubernetes/kubernetes/pull/78691">#78691</a>)</li>
<li>GLBC remains unchanged at v1.2.3 as of Kubernetes 1.12. (<a href="https://github.com/kubernetes/kubernetes/pull/66793">#66793</a>)</li>
<li>Ingress-gce remains unchanged at v1.2.3 as of Kubernetes 1.12. (<a href="https://github.com/kubernetes/kubernetes/pull/66793">#66793</a>)</li>
</ul>

<h1 id="upgrading-kubeadm-clusters-from-v1-14-to-v1-15">Upgrading kubeadm clusters from v1.14 to v1.15</h1>

<p>This page explains how to upgrade a Kubernetes cluster created with kubeadm from version
1.14.x to version 1.15.x, and from version 1.15.x to 1.15.y (where <code>y &gt; x</code>).</p>

<p>The upgrade workflow at high level is the following:</p>

<ol>
<li>Upgrade the primary control plane node.</li>
<li>Upgrade additional control plane nodes.</li>
<li>Upgrade worker nodes.</li>
</ol>

<ul>
<li>You need to have a kubeadm Kubernetes cluster running version 1.14.0 or later.</li>
<li><a href="https://serverfault.com/questions/684771/best-way-to-disable-swap-in-linux">Swap must be disabled</a>.</li>
<li>The cluster should use a static control plane and etcd pods or external etcd.</li>
<li>Make sure you read the <a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.15.md">release notes</a> carefully.</li>
<li>Make sure to back up any important components, such as app-level state stored in a database.
<code>kubeadm upgrade</code> does not touch your workloads, only components internal to Kubernetes, but backups are always a best practice.</li>
</ul>

<h3 id="additional-information">Additional information</h3>

<ul>
<li>All containers are restarted after upgrade, because the container spec hash value is changed.</li>
<li>You only can upgrade from one MINOR version to the next MINOR version,
or between PATCH versions of the same MINOR. That is, you cannot skip MINOR versions when you upgrade.
For example, you can upgrade from 1.y to 1.y+1, but not from 1.y to 1.y+2.</li>
</ul>

<h2 id="determine-which-version-to-upgrade-to">Determine which version to upgrade to</h2>

<ol>
<li><p>Find the latest stable 1.15 version:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">yum makecache fast
yum list --showduplicates kubeadm --disableexcludes<span class="o">=</span>kubernetes
<span class="c1"># find the latest 1.15 version in the list</span>
<span class="c1"># it should look like 1.15.x-0, where x is the latest patch</span></code></pre></td></tr></table>
</div>
</div></li>
</ol>

<h2 id="upgrade-the-first-control-plane-node">Upgrade the first control plane node</h2>

<ol>
<li><p>On your first control plane node, upgrade kubeadm:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># replace x in 1.15.x-0 with the latest patch version</span>
yum install -y kubeadm-1.15.x-0 --disableexcludes<span class="o">=</span>kubernetes

安装新版kubeadm
yum install -y kubeadm-1.15.0-0 --disableexcludes<span class="o">=</span>kubernetes</code></pre></td></tr></table>
</div>
</div></li>

<li><p>Verify that the download works and has the expected version:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubeadm version

显示信息如下：
kubeadm version
kubeadm version: <span class="p">&amp;</span>version.Info<span class="o">{</span>Major:<span class="s2">&#34;1&#34;</span>, Minor:<span class="s2">&#34;15&#34;</span>, GitVersion:<span class="s2">&#34;v1.15.0&#34;</span>, GitCommit:<span class="s2">&#34;e8462b5b5dc2584fdcd18e6bcfe9f1e4d970a529&#34;</span>, GitTreeState:<span class="s2">&#34;clean&#34;</span>, BuildDate:<span class="s2">&#34;2019-06-19T16:37:41Z&#34;</span>, GoVersion:<span class="s2">&#34;go1.12.5&#34;</span>, Compiler:<span class="s2">&#34;gc&#34;</span>, Platform:<span class="s2">&#34;linux/amd64&#34;</span><span class="o">}</span></code></pre></td></tr></table>
</div>
</div></li>

<li><p>On the control plane node, run:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo kubeadm upgrade plan</code></pre></td></tr></table>
</div>
</div>
<p>You should see output similar to this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubeadm upgrade plan
<span class="o">[</span>upgrade/config<span class="o">]</span> Making sure the configuration is correct:
<span class="o">[</span>upgrade/config<span class="o">]</span> Reading configuration from the cluster...
<span class="o">[</span>upgrade/config<span class="o">]</span> FYI: You can look at this config file with <span class="s1">&#39;kubectl -n kube-system get cm kubeadm-config -oyaml&#39;</span>
<span class="o">[</span>preflight<span class="o">]</span> Running pre-flight checks.
<span class="o">[</span>upgrade<span class="o">]</span> Making sure the cluster is healthy:
<span class="o">[</span>upgrade<span class="o">]</span> Fetching available versions to upgrade to
<span class="o">[</span>upgrade/versions<span class="o">]</span> Cluster version: v1.14.1
<span class="o">[</span>upgrade/versions<span class="o">]</span> kubeadm version: v1.15.0
W0702 <span class="m">15</span>:12:20.713022   <span class="m">19841</span> version.go:98<span class="o">]</span> could not fetch a Kubernetes version from the internet: unable to get URL <span class="s2">&#34;https://dl.k8s.io/release/stable.txt&#34;</span>: Get https://dl.k8s.io/release/stable.txt: net/http: request canceled <span class="k">while</span> waiting <span class="k">for</span> connection <span class="o">(</span>Client.Timeout exceeded <span class="k">while</span> awaiting headers<span class="o">)</span>
W0702 <span class="m">15</span>:12:20.713088   <span class="m">19841</span> version.go:99<span class="o">]</span> falling back to the <span class="nb">local</span> client version: v1.15.0
<span class="o">[</span>upgrade/versions<span class="o">]</span> Latest stable version: v1.15.0
W0702 <span class="m">15</span>:12:31.063363   <span class="m">19841</span> version.go:98<span class="o">]</span> could not fetch a Kubernetes version from the internet: unable to get URL <span class="s2">&#34;https://dl.k8s.io/release/stable-1.14.txt&#34;</span>: Get https://dl.k8s.io/release/stable-1.14.txt: net/http: request canceled <span class="k">while</span> waiting <span class="k">for</span> connection <span class="o">(</span>Client.Timeout exceeded <span class="k">while</span> awaiting headers<span class="o">)</span>
W0702 <span class="m">15</span>:12:31.063441   <span class="m">19841</span> version.go:99<span class="o">]</span> falling back to the <span class="nb">local</span> client version: v1.15.0
<span class="o">[</span>upgrade/versions<span class="o">]</span> Latest version in the v1.14 series: v1.15.0

Components that must be upgraded manually after you have upgraded the control plane with <span class="s1">&#39;kubeadm upgrade apply&#39;</span>:
COMPONENT   CURRENT       AVAILABLE
Kubelet     <span class="m">6</span> x v1.14.1   v1.15.0

Upgrade to the latest version in the v1.14 series:

COMPONENT            CURRENT   AVAILABLE
API Server           v1.14.1   v1.15.0
Controller Manager   v1.14.1   v1.15.0
Scheduler            v1.14.1   v1.15.0
Kube Proxy           v1.14.1   v1.15.0
CoreDNS              <span class="m">1</span>.3.1     <span class="m">1</span>.3.1
Etcd                 <span class="m">3</span>.3.10    <span class="m">3</span>.3.10

You can now apply the upgrade by executing the following command:

        kubeadm upgrade apply v1.15.0

_____________________________________________________________________</code></pre></td></tr></table>
</div>
</div>
<p>This command checks that your cluster can be upgraded, and fetches the versions you can upgrade to.</p>

<p>With the release of Kubernetes v1.15, <code>kubeadm upgrade</code> also automatically renews
the certificates that it manages on this node. To opt-out of certificate renewal the flag <code>--certificate-renewal=false</code> can be used.
For more information see the <a href="/docs/tasks/administer-cluster/kubeadm/kubeadm-certs">certificate management guide</a>.</p></li>

<li><p>Choose a version to upgrade to, and run the appropriate command. For example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo kubeadm upgrade apply v1.15.x

详细安装命令：
sudo kubeadm upgrade apply v1.15.0</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>Replace <code>x</code> with the patch version you picked for this upgrade.</li>
</ul>

<p>You should see output similar to this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo kubeadm upgrade apply v1.15.0
<span class="o">[</span>upgrade/config<span class="o">]</span> Making sure the configuration is correct:
<span class="o">[</span>upgrade/config<span class="o">]</span> Reading configuration from the cluster...
<span class="o">[</span>upgrade/config<span class="o">]</span> FYI: You can look at this config file with <span class="s1">&#39;kubectl -n kube-system get cm kubeadm-config -oyaml&#39;</span>
<span class="o">[</span>preflight<span class="o">]</span> Running pre-flight checks.
<span class="o">[</span>upgrade<span class="o">]</span> Making sure the cluster is healthy:
<span class="o">[</span>upgrade/version<span class="o">]</span> You have chosen to change the cluster version to <span class="s2">&#34;v1.15.0&#34;</span>
<span class="o">[</span>upgrade/versions<span class="o">]</span> Cluster version: v1.14.1
<span class="o">[</span>upgrade/versions<span class="o">]</span> kubeadm version: v1.15.0
<span class="o">[</span>upgrade/confirm<span class="o">]</span> Are you sure you want to proceed with the upgrade? <span class="o">[</span>y/N<span class="o">]</span>: y
<span class="o">[</span>upgrade/prepull<span class="o">]</span> Will prepull images <span class="k">for</span> components <span class="o">[</span>kube-apiserver kube-controller-manager kube-scheduler etcd<span class="o">]</span>
<span class="o">[</span>upgrade/prepull<span class="o">]</span> Prepulling image <span class="k">for</span> component etcd.
<span class="o">[</span>upgrade/prepull<span class="o">]</span> Prepulling image <span class="k">for</span> component kube-apiserver.
<span class="o">[</span>upgrade/prepull<span class="o">]</span> Prepulling image <span class="k">for</span> component kube-controller-manager.
<span class="o">[</span>upgrade/prepull<span class="o">]</span> Prepulling image <span class="k">for</span> component kube-scheduler.
<span class="o">[</span>apiclient<span class="o">]</span> Found <span class="m">3</span> Pods <span class="k">for</span> label selector k8s-app<span class="o">=</span>upgrade-prepull-kube-controller-manager
<span class="o">[</span>apiclient<span class="o">]</span> Found <span class="m">1</span> Pods <span class="k">for</span> label selector k8s-app<span class="o">=</span>upgrade-prepull-kube-scheduler
<span class="o">[</span>apiclient<span class="o">]</span> Found <span class="m">0</span> Pods <span class="k">for</span> label selector k8s-app<span class="o">=</span>upgrade-prepull-etcd
<span class="o">[</span>apiclient<span class="o">]</span> Found <span class="m">3</span> Pods <span class="k">for</span> label selector k8s-app<span class="o">=</span>upgrade-prepull-kube-apiserver
<span class="o">[</span>apiclient<span class="o">]</span> Found <span class="m">3</span> Pods <span class="k">for</span> label selector k8s-app<span class="o">=</span>upgrade-prepull-kube-scheduler
<span class="o">[</span>apiclient<span class="o">]</span> Found <span class="m">3</span> Pods <span class="k">for</span> label selector k8s-app<span class="o">=</span>upgrade-prepull-etcd
<span class="o">[</span>upgrade/prepull<span class="o">]</span> Prepulled image <span class="k">for</span> component etcd.
<span class="o">[</span>upgrade/prepull<span class="o">]</span> Prepulled image <span class="k">for</span> component kube-apiserver.
<span class="o">[</span>upgrade/prepull<span class="o">]</span> Prepulled image <span class="k">for</span> component kube-controller-manager.
<span class="o">[</span>upgrade/prepull<span class="o">]</span> Prepulled image <span class="k">for</span> component kube-scheduler.
<span class="o">[</span>upgrade/prepull<span class="o">]</span> Successfully prepulled the images <span class="k">for</span> all the control plane components
<span class="o">[</span>upgrade/apply<span class="o">]</span> Upgrading your Static Pod-hosted control plane to version <span class="s2">&#34;v1.15.0&#34;</span>...
Static pod: kube-apiserver-kubecon-vapp11160 hash: 0aa9c75f95ab5b281e361ed890e145c7
Static pod: kube-controller-manager-kubecon-vapp11160 hash: 6a929b03b25a87ec3aa12c126dd203e0
Static pod: kube-scheduler-kubecon-vapp11160 hash: f6038c6cd5a85d4e6bb2b14e4743e83d
<span class="o">[</span>upgrade/etcd<span class="o">]</span> Upgrading to TLS <span class="k">for</span> etcd
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Writing new Static Pod manifests to <span class="s2">&#34;/etc/kubernetes/tmp/kubeadm-upgraded-manifests853430691&#34;</span>
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Preparing <span class="k">for</span> <span class="s2">&#34;kube-apiserver&#34;</span> upgrade
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Renewing apiserver certificate
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Renewing apiserver-kubelet-client certificate
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Renewing front-proxy-client certificate
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Renewing apiserver-etcd-client certificate
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Moved new manifest to <span class="s2">&#34;/etc/kubernetes/manifests/kube-apiserver.yaml&#34;</span> and backed up old manifest to <span class="s2">&#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-07-02-15-18-46/kube-apiserver.yaml&#34;</span>
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Waiting <span class="k">for</span> the kubelet to restart the component
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> This might take a minute or longer depending on the component/version gap <span class="o">(</span>timeout 5m0s<span class="o">)</span>
Static pod: kube-apiserver-kubecon-vapp11160 hash: 0aa9c75f95ab5b281e361ed890e145c7
Static pod: kube-apiserver-kubecon-vapp11160 hash: 0aa9c75f95ab5b281e361ed890e145c7
Static pod: kube-apiserver-kubecon-vapp11160 hash: c7c3adfbb3617f2f5b28ec57eb46c5a6
<span class="o">[</span>apiclient<span class="o">]</span> Found <span class="m">3</span> Pods <span class="k">for</span> label selector <span class="nv">component</span><span class="o">=</span>kube-apiserver
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Component <span class="s2">&#34;kube-apiserver&#34;</span> upgraded successfully!
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Preparing <span class="k">for</span> <span class="s2">&#34;kube-controller-manager&#34;</span> upgrade
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Renewing controller-manager.conf certificate
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Moved new manifest to <span class="s2">&#34;/etc/kubernetes/manifests/kube-controller-manager.yaml&#34;</span> and backed up old manifest to <span class="s2">&#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-07-02-15-18-46/kube-controller-manager.yaml&#34;</span>
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Waiting <span class="k">for</span> the kubelet to restart the component
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> This might take a minute or longer depending on the component/version gap <span class="o">(</span>timeout 5m0s<span class="o">)</span>
Static pod: kube-controller-manager-kubecon-vapp11160 hash: 6a929b03b25a87ec3aa12c126dd203e0
Static pod: kube-controller-manager-kubecon-vapp11160 hash: 140db3b140859389357b7ece4da4f43d
<span class="o">[</span>apiclient<span class="o">]</span> Found <span class="m">3</span> Pods <span class="k">for</span> label selector <span class="nv">component</span><span class="o">=</span>kube-controller-manager
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Component <span class="s2">&#34;kube-controller-manager&#34;</span> upgraded successfully!
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Preparing <span class="k">for</span> <span class="s2">&#34;kube-scheduler&#34;</span> upgrade
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Renewing scheduler.conf certificate
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Moved new manifest to <span class="s2">&#34;/etc/kubernetes/manifests/kube-scheduler.yaml&#34;</span> and backed up old manifest to <span class="s2">&#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-07-02-15-18-46/kube-scheduler.yaml&#34;</span>
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Waiting <span class="k">for</span> the kubelet to restart the component
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> This might take a minute or longer depending on the component/version gap <span class="o">(</span>timeout 5m0s<span class="o">)</span>
Static pod: kube-scheduler-kubecon-vapp11160 hash: f6038c6cd5a85d4e6bb2b14e4743e83d
Static pod: kube-scheduler-kubecon-vapp11160 hash: f6038c6cd5a85d4e6bb2b14e4743e83d
Static pod: kube-scheduler-kubecon-vapp11160 hash: f6038c6cd5a85d4e6bb2b14e4743e83d
Static pod: kube-scheduler-kubecon-vapp11160 hash: 3f870b1ade82dfb7e434c2862adf7402
<span class="o">[</span>apiclient<span class="o">]</span> Found <span class="m">3</span> Pods <span class="k">for</span> label selector <span class="nv">component</span><span class="o">=</span>kube-scheduler
<span class="o">[</span>upgrade/staticpods<span class="o">]</span> Component <span class="s2">&#34;kube-scheduler&#34;</span> upgraded successfully!
<span class="o">[</span>upload-config<span class="o">]</span> Storing the configuration used in ConfigMap <span class="s2">&#34;kubeadm-config&#34;</span> in the <span class="s2">&#34;kube-system&#34;</span> Namespace
<span class="o">[</span>kubelet<span class="o">]</span> Creating a ConfigMap <span class="s2">&#34;kubelet-config-1.15&#34;</span> in namespace kube-system with the configuration <span class="k">for</span> the kubelets in the cluster
<span class="o">[</span>kubelet-start<span class="o">]</span> Downloading configuration <span class="k">for</span> the kubelet from the <span class="s2">&#34;kubelet-config-1.15&#34;</span> ConfigMap in the kube-system namespace
<span class="o">[</span>kubelet-start<span class="o">]</span> Writing kubelet configuration to file <span class="s2">&#34;/var/lib/kubelet/config.yaml&#34;</span>
<span class="o">[</span>bootstrap-token<span class="o">]</span> configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order <span class="k">for</span> nodes to get long term certificate credentials
<span class="o">[</span>bootstrap-token<span class="o">]</span> configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
<span class="o">[</span>bootstrap-token<span class="o">]</span> configured RBAC rules to allow certificate rotation <span class="k">for</span> all node client certificates in the cluster
<span class="o">[</span>addons<span class="o">]</span> Applied essential addon: CoreDNS
<span class="o">[</span>addons<span class="o">]</span> Applied essential addon: kube-proxy

<span class="o">[</span>upgrade/successful<span class="o">]</span> SUCCESS! Your cluster was upgraded to <span class="s2">&#34;v1.15.0&#34;</span>. Enjoy!

<span class="o">[</span>upgrade/kubelet<span class="o">]</span> Now that your control plane is upgraded, please proceed with upgrading your kubelets <span class="k">if</span> you haven<span class="err">&#39;</span>t already <span class="k">done</span> so.</code></pre></td></tr></table>
</div>
</div>
<p>如果有多个控制节点，我们需要再每个控制节点上面都操作一下。</p></li>

<li><p>Manually upgrade your CNI provider plugin.</p>

<p>Your Container Network Interface (CNI) provider may have its own upgrade instructions to follow.
Check the <a href="/docs/concepts/cluster-administration/addons/">addons</a> page to
find your CNI provider and see whether additional upgrade steps are required.</p></li>

<li><p>Upgrade the kubelet and kubectl on the control plane node:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># replace x in 1.15.x-0 with the latest patch version</span>
yum install -y kubelet-1.15.x-0 kubectl-1.15.x-0 --disableexcludes<span class="o">=</span>kubernetes

详细安装命令：
yum install -y kubelet-1.15.0-0 kubectl-1.15.0-0 --disableexcludes<span class="o">=</span>kubernetes</code></pre></td></tr></table>
</div>
</div></li>

<li><p>Restart the kubelet</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo systemctl daemon-reload
sudo systemctl restart kubelet</code></pre></td></tr></table>
</div>
</div></li>
</ol>

<h2 id="upgrade-additional-control-plane-nodes">Upgrade additional control plane nodes</h2>

<ol>
<li><p>Same as the first control plane node but use:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo kubeadm upgrade node</code></pre></td></tr></table>
</div>
</div>
<p>instead of:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo kubeadm upgrade apply</code></pre></td></tr></table>
</div>
</div></li>
</ol>

<p>Also <code>sudo kubeadm upgrade plan</code> is not needed.</p>

<h2 id="upgrade-worker-nodes">Upgrade worker nodes</h2>

<p>The upgrade procedure on worker nodes should be executed one node at a time or few nodes at a time,
without compromising the minimum required capacity for running your workloads.</p>

<h3 id="upgrade-kubeadm">Upgrade kubeadm</h3>

<ol>
<li><p>Upgrade kubeadm on all worker nodes:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># replace x in 1.15.x-0 with the latest patch version</span>
yum install -y kubeadm-1.15.x-0 --disableexcludes<span class="o">=</span>kubernetes

详细安装命令：
yum install -y kubeadm-1.15.0-0 --disableexcludes<span class="o">=</span>kubernetes</code></pre></td></tr></table>
</div>
</div></li>
</ol>

<h3 id="drain-the-node">Drain the node</h3>

<ol>
<li><p>Prepare the node for maintenance by marking it unschedulable and evicting the workloads. Run:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl drain <span class="nv">$NODE</span> --ignore-daemonsets</code></pre></td></tr></table>
</div>
</div>
<p>You should see output similar to this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">node/ip-172-31-85-18 cordoned
WARNING: ignoring DaemonSet-managed Pods: kube-system/kube-proxy-dj7d7, kube-system/weave-net-z65qx
node/ip-172-31-85-18 drained</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></pre></td>
<td class="lntd">
<pre class="chroma">详细命令如下：
控制平面节点：
kubectl drain kubecon-vapp11160  --ignore-daemonsets  
kubectl drain kubecon-vapp11170  --ignore-daemonsets  
kubectl drain kubecon-vapp11242  --ignore-daemonsets  
您应该看到与此类似的输出：
# kubectl drain kubecon-vapp11170  --ignore-daemonsets  
node/kubecon-vapp11170 cordoned
WARNING: ignoring DaemonSet-managed Pods: kube-system/calico-node-zjhbs, kube-system/kube-proxy-b224h, kube-system/traefik-ingress-controller-8krgq
node/kubecon-vapp11170 drained

Node节点：
kubectl drain kubecon-app02
kubectl drain kubecon-app03
kubectl drain kubecon-app11245</pre></td></tr></table>
</div>
</div></li>
</ol>

<h3 id="upgrade-the-kubelet-configuration">Upgrade the kubelet configuration</h3>

<ol>
<li><p>Call the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo kubeadm upgrade node</code></pre></td></tr></table>
</div>
</div></li>
</ol>

<h3 id="upgrade-kubelet-and-kubectl">Upgrade kubelet and kubectl</h3>

<ol>
<li><p>Upgrade the Kubernetes package version by running the Linux package manager for your distribution:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span></pre></td>
<td class="lntd">
<pre class="chroma"># replace x in 1.15.x-0 with the latest patch version
yum install -y kubelet-1.15.x-0 kubectl-1.15.x-0 --disableexcludes=kubernetes</pre></td></tr></table>
</div>
</div></li>

<li><p>Restart the kubelet</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sudo systemctl daemon-reload
sudo systemctl restart kubelet</code></pre></td></tr></table>
</div>
</div></li>
</ol>

<h3 id="uncordon-the-node">Uncordon the node</h3>

<ol>
<li><p>Bring the node back online by marking it schedulable:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl uncordon <span class="nv">$NODE</span>

详细命令如下：
<span class="o">[</span>root@kubecon-vapp11160 ~<span class="o">]</span><span class="c1"># kubectl uncordon kubecon-vapp11160</span>
<span class="o">[</span>root@kubecon-vapp11160 ~<span class="o">]</span><span class="c1"># kubectl uncordon kubecon-vapp11170</span>
<span class="o">[</span>root@kubecon-vapp11160 ~<span class="o">]</span><span class="c1"># kubectl uncordon kubecon-vapp11242</span>
<span class="o">[</span>root@kubecon-vapp11160 ~<span class="o">]</span><span class="c1"># kubectl uncordon kubecon-app02</span>
<span class="o">[</span>root@kubecon-vapp11160 ~<span class="o">]</span><span class="c1"># kubectl uncordon kubecon-app03</span>
<span class="o">[</span>root@kubecon-vapp11160 ~<span class="o">]</span><span class="c1"># kubectl uncordon kubecon-app11245</span></code></pre></td></tr></table>
</div>
</div></li>
</ol>

<h2 id="verify-the-status-of-the-cluster">Verify the status of the cluster</h2>

<p>After the kubelet is upgraded on all nodes verify that all nodes are available again by running the following command from anywhere kubectl can access the cluster:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl get nodes

你可以看到如下输出：
kubectl get node
NAME               STATUS   ROLES    AGE    VERSION
kubecon-app02       Ready    &lt;none&gt;   179d   v1.15.0
kubecon-app03       Ready    &lt;none&gt;   179d   v1.15.0
kubecon-app11245    Ready    &lt;none&gt;   179d   v1.15.0
kubecon-vapp11160   Ready    master   179d   v1.15.0
kubecon-vapp11170   Ready    master   179d   v1.15.0
kubecon-vapp11242   Ready    master   179d   v1.15.0</code></pre></td></tr></table>
</div>
</div>
<p>The <code>STATUS</code> column should show <code>Ready</code> for all your nodes, and the version number should be updated.</p>

<h2 id="recovering-from-a-failure-state">Recovering from a failure state</h2>

<p>If <code>kubeadm upgrade</code> fails and does not roll back, for example because of an unexpected shutdown during execution, you can run <code>kubeadm upgrade</code> again.
This command is idempotent and eventually makes sure that the actual state is the desired state you declare.</p>

<p>To recover from a bad state, you can also run <code>kubeadm upgrade --force</code> without changing the version that your cluster is running.</p>

<h2 id="how-it-works">How it works</h2>

<p><code>kubeadm upgrade apply</code> does the following:</p>

<ul>
<li>Checks that your cluster is in an upgradeable state:

<ul>
<li>The API server is reachable</li>
<li>All nodes are in the <code>Ready</code> state</li>
<li>The control plane is healthy</li>
</ul></li>
<li>Enforces the version skew policies.</li>
<li>Makes sure the control plane images are available or available to pull to the machine.</li>
<li>Upgrades the control plane components or rollbacks if any of them fails to come up.</li>
<li>Applies the new <code>kube-dns</code> and <code>kube-proxy</code> manifests and makes sure that all necessary RBAC rules are created.</li>
<li>Creates new certificate and key files of the API server and backs up old files if they&rsquo;re about to expire in 180 days.</li>
</ul>

<p><code>kubeadm upgrade node</code> does the following on additional control plane nodes:</p>

<ul>
<li>Fetches the kubeadm <code>ClusterConfiguration</code> from the cluster.</li>
<li>Optionally backups the kube-apiserver certificate.</li>
<li>Upgrades the static Pod manifests for the control plane components.</li>
<li>Upgrades the kubelet configuration for this node.</li>
</ul>

<p><code>kubeadm upgrade node</code> does the following on worker nodes:</p>

<ul>
<li>Fetches the kubeadm <code>ClusterConfiguration</code> from the cluster.</li>
<li>Upgrades the kubelet configuration for this node.</li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">SoHuDrgon</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2019-07-02
        <a href="https://github.com/guogang1990/sohudrgon.ml.git/commit/dce9a428e87cfd1ec0c438e1d26e091314062759" title="rebuilding site 2019年 7月 2日 星期二 16时00分07秒 CST">(dce9a42)</a>
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/kubernetes/">“kubernetes</a>
          <a href="/tags/kubeadm/">kubeadm”</a>
          </div>
      <nav class="post-nav">
        
        <a class="next" href="/post/zabbix%E7%9B%91%E6%8E%A7rabbitmq/">
            <span class="next-text nav-default">Zabbix监控rabbitmq</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="lv-container" data-id="city" data-uid="MTAyMC80Mzc2Ny8yMDMwNg==">
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];

        if (typeof LivereTower === 'function') { return; }

        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;

        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
    <noscript>Please enable JavaScript to view the comments powered by <a href="https://livere.com/">LiveRe.</a></noscript>
    </div>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:guogang1990@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://www.twitter.com/SoHuDrgon" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/guogang1990" class="iconfont icon-github" title="github"></a>
  <a href="https://sohudrgon.ml/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次 </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> 本站总访客数 <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 人 </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">SoHuDrgon</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>








</body>
</html>
